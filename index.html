<!DOCTYPE html>
<!-- saved from url=(0183)file:///C:/Users/86186/Downloads/%E7%95%AA%E8%8C%84%E5%B7%A5%E5%9D%8A_%E7%95%AA%E8%8C%84%E8%AE%A1%E6%97%B6%E5%99%A8%E5%BE%AA%E7%8E%AF%E8%BE%93%E5%85%A5%E5%8F%B3%E4%BE%A7%E7%89%88.html -->
<html lang="zh-CN">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta content="width=device-width, initial-scale=1" name="viewport">

  <title>ğŸ… è¯·åƒå°ç•ªèŒ„ï¼</title>
  <!-- TailwindCSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Tailwind config must be set after CDN loads -->
  <!-- Chart.js for charts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="./ğŸ… è¯·åƒå°ç•ªèŒ„!_files/chart.js.ä¸‹è½½"></script>
  <style>
    /* 3D ç¿»ç‰Œ */
    .perspective {
      perspective: 1200px;
    }

    .preserve-3d {
      transform-style: preserve-3d;
    }

    .backface-hidden {
      backface-visibility: hidden;
    }

    .rotate-y-180 {
      transform: rotateY(180deg);
    }

    .flip-card {
      transition: transform 0.7s;
    }

    /* ç®€æ˜“ç­¾åˆ°æ—¥å†æ ·å¼ */
    .cal-cell {
      border: 1px solid rgba(0, 0, 0, 0.08);
      background: rgba(255, 255, 255, 0.7);
      border-radius: 0.5rem;
      padding: 0.35rem 0.25rem;
      min-height: 48px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .cal-cell.muted {
      opacity: 0.45;
    }

    .cal-cell .day {
      font-weight: 600;
    }

    .cal-cell .mark {
      font-size: 1rem;
      line-height: 1;
      margin-top: 0.1rem;
    }

    /* ç¾åŒ–ç§¯åˆ†è®°å½•è¡¨æ ¼ */
    #ledgerList>div {
      border-bottom: 1px solid rgba(0, 0, 0, 0.08);
    }

    #ledgerList>div:last-child {
      border-bottom: none;
    }

    /* ä¸€ç•ªèµè®°å½•è¡¨æ ¼æ ·å¼ */
    #lotteryLogList>div {
      border-bottom: 1px solid rgba(0, 0, 0, 0.08);
    }

    #lotteryLogList>div:last-child {
      border-bottom: none;
    }
  </style>
  <style>
    *,
    ::before,
    ::after {
      --tw-border-spacing-x: 0;
      --tw-border-spacing-y: 0;
      --tw-translate-x: 0;
      --tw-translate-y: 0;
      --tw-rotate: 0;
      --tw-skew-x: 0;
      --tw-skew-y: 0;
      --tw-scale-x: 1;
      --tw-scale-y: 1;
      --tw-pan-x: ;
      --tw-pan-y: ;
      --tw-pinch-zoom: ;
      --tw-scroll-snap-strictness: proximity;
      --tw-gradient-from-position: ;
      --tw-gradient-via-position: ;
      --tw-gradient-to-position: ;
      --tw-ordinal: ;
      --tw-slashed-zero: ;
      --tw-numeric-figure: ;
      --tw-numeric-spacing: ;
      --tw-numeric-fraction: ;
      --tw-ring-inset: ;
      --tw-ring-offset-width: 0px;
      --tw-ring-offset-color: #fff;
      --tw-ring-color: rgb(59 130 246 / 0.5);
      --tw-ring-offset-shadow: 0 0 #0000;
      --tw-ring-shadow: 0 0 #0000;
      --tw-shadow: 0 0 #0000;
      --tw-shadow-colored: 0 0 #0000;
      --tw-blur: ;
      --tw-brightness: ;
      --tw-contrast: ;
      --tw-grayscale: ;
      --tw-hue-rotate: ;
      --tw-invert: ;
      --tw-saturate: ;
      --tw-sepia: ;
      --tw-drop-shadow: ;
      --tw-backdrop-blur: ;
      --tw-backdrop-brightness: ;
      --tw-backdrop-contrast: ;
      --tw-backdrop-grayscale: ;
      --tw-backdrop-hue-rotate: ;
      --tw-backdrop-invert: ;
      --tw-backdrop-opacity: ;
      --tw-backdrop-saturate: ;
      --tw-backdrop-sepia: ;
      --tw-contain-size: ;
      --tw-contain-layout: ;
      --tw-contain-paint: ;
      --tw-contain-style:
    }

    ::backdrop {
      --tw-border-spacing-x: 0;
      --tw-border-spacing-y: 0;
      --tw-translate-x: 0;
      --tw-translate-y: 0;
      --tw-rotate: 0;
      --tw-skew-x: 0;
      --tw-skew-y: 0;
      --tw-scale-x: 1;
      --tw-scale-y: 1;
      --tw-pan-x: ;
      --tw-pan-y: ;
      --tw-pinch-zoom: ;
      --tw-scroll-snap-strictness: proximity;
      --tw-gradient-from-position: ;
      --tw-gradient-via-position: ;
      --tw-gradient-to-position: ;
      --tw-ordinal: ;
      --tw-slashed-zero: ;
      --tw-numeric-figure: ;
      --tw-numeric-spacing: ;
      --tw-numeric-fraction: ;
      --tw-ring-inset: ;
      --tw-ring-offset-width: 0px;
      --tw-ring-offset-color: #fff;
      --tw-ring-color: rgb(59 130 246 / 0.5);
      --tw-ring-offset-shadow: 0 0 #0000;
      --tw-ring-shadow: 0 0 #0000;
      --tw-shadow: 0 0 #0000;
      --tw-shadow-colored: 0 0 #0000;
      --tw-blur: ;
      --tw-brightness: ;
      --tw-contrast: ;
      --tw-grayscale: ;
      --tw-hue-rotate: ;
      --tw-invert: ;
      --tw-saturate: ;
      --tw-sepia: ;
      --tw-drop-shadow: ;
      --tw-backdrop-blur: ;
      --tw-backdrop-brightness: ;
      --tw-backdrop-contrast: ;
      --tw-backdrop-grayscale: ;
      --tw-backdrop-hue-rotate: ;
      --tw-backdrop-invert: ;
      --tw-backdrop-opacity: ;
      --tw-backdrop-saturate: ;
      --tw-backdrop-sepia: ;
      --tw-contain-size: ;
      --tw-contain-layout: ;
      --tw-contain-paint: ;
      --tw-contain-style:
    }

    /* ! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com */
    *,
    ::after,
    ::before {
      box-sizing: border-box;
      border-width: 0;
      border-style: solid;
      border-color: #e5e7eb
    }

    ::after,
    ::before {
      --tw-content: ''
    }

    :host,
    html {
      line-height: 1.5;
      -webkit-text-size-adjust: 100%;
      -moz-tab-size: 4;
      tab-size: 4;
      font-family: ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
      font-feature-settings: normal;
      font-variation-settings: normal;
      -webkit-tap-highlight-color: transparent
    }

    body {
      margin: 0;
      line-height: inherit
    }

    hr {
      height: 0;
      color: inherit;
      border-top-width: 1px
    }

    abbr:where([title]) {
      -webkit-text-decoration: underline dotted;
      text-decoration: underline dotted
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      font-size: inherit;
      font-weight: inherit
    }

    a {
      color: inherit;
      text-decoration: inherit
    }

    b,
    strong {
      font-weight: bolder
    }

    code,
    kbd,
    pre,
    samp {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-feature-settings: normal;
      font-variation-settings: normal;
      font-size: 1em
    }

    small {
      font-size: 80%
    }

    sub,
    sup {
      font-size: 75%;
      line-height: 0;
      position: relative;
      vertical-align: baseline
    }

    sub {
      bottom: -.25em
    }

    sup {
      top: -.5em
    }

    table {
      text-indent: 0;
      border-color: inherit;
      border-collapse: collapse
    }

    button,
    input,
    optgroup,
    select,
    textarea {
      font-family: inherit;
      font-feature-settings: inherit;
      font-variation-settings: inherit;
      font-size: 100%;
      font-weight: inherit;
      line-height: inherit;
      letter-spacing: inherit;
      color: inherit;
      margin: 0;
      padding: 0
    }

    button,
    select {
      text-transform: none
    }

    button,
    input:where([type=button]),
    input:where([type=reset]),
    input:where([type=submit]) {
      -webkit-appearance: button;
      appearance: button;
      background-color: transparent;
      background-image: none
    }

    :-moz-focusring {
      outline: auto
    }

    :-moz-ui-invalid {
      box-shadow: none
    }

    progress {
      vertical-align: baseline
    }

    ::-webkit-inner-spin-button,
    ::-webkit-outer-spin-button {
      height: auto
    }

    [type=search] {
      -webkit-appearance: textfield;
      appearance: textfield;
      outline-offset: -2px
    }

    ::-webkit-search-decoration {
      -webkit-appearance: none
    }

    ::-webkit-file-upload-button {
      -webkit-appearance: button;
      font: inherit
    }

    summary {
      display: list-item
    }

    blockquote,
    dd,
    dl,
    figure,
    h1,
    h2,
    h3,
    h4,
    h5,
    h6,
    hr,
    p,
    pre {
      margin: 0
    }

    fieldset {
      margin: 0;
      padding: 0
    }

    legend {
      padding: 0
    }

    menu,
    ol,
    ul {
      list-style: none;
      margin: 0;
      padding: 0
    }

    dialog {
      padding: 0
    }

    textarea {
      resize: vertical
    }

    input::placeholder,
    textarea::placeholder {
      opacity: 1;
      color: #9ca3af
    }

    [role=button],
    button {
      cursor: pointer
    }

    :disabled {
      cursor: default
    }

    audio,
    canvas,
    embed,
    iframe,
    img,
    object,
    svg,
    video {
      display: block;
    }

    img,
    video {
      max-width: 100%;
      height: auto
    }

    [hidden]:where(:not([hidden=until-found])) {
      display: none
    }

    .absolute {
      position: absolute
    }

    .relative {
      position: relative
    }

    .inset-0 {
      inset: 0px
    }

    .inset-3 {
      inset: 0.75rem
    }

    .mx-auto {
      margin-left: auto;
      margin-right: auto
    }

    .mb-1 {
      margin-bottom: 0.25rem
    }

    .mb-2 {
      margin-bottom: 0.5rem
    }

    .mb-3 {
      margin-bottom: 0.75rem
    }

    .mb-4 {
      margin-bottom: 1rem
    }

    .mt-1 {
      margin-top: 0.25rem
    }

    .mt-10 {
      margin-top: 2.5rem
    }

    .mt-2 {
      margin-top: 0.5rem
    }

    .mt-3 {
      margin-top: 0.75rem
    }

    .block {
      display: block
    }

    .flex {
      display: flex
    }

    .inline-flex {
      display: inline-flex
    }

    .grid {
      display: grid
    }

    .hidden {
      display: none
    }

    .h-32 {
      height: 8rem
    }

    .h-36 {
      height: 9rem
    }

    .h-48 {
      height: 12rem
    }

    .h-\[260px\] {
      height: 260px
    }

    .min-h-screen {
      min-height: 100vh
    }

    .w-32 {
      width: 8rem
    }

    .w-64 {
      width: 16rem
    }

    .w-full {
      width: 100%
    }

    .min-w-\[320px\] {
      min-width: 320px
    }

    .max-w-6xl {
      max-width: 72rem
    }

    .flex-1 {
      flex: 1 1 0%
    }

    .cursor-pointer {
      cursor: pointer
    }

    .select-none {
      -webkit-user-select: none;
      user-select: none
    }

    .grid-cols-1 {
      grid-template-columns: repeat(1, minmax(0, 1fr))
    }

    .grid-cols-2 {
      grid-template-columns: repeat(2, minmax(0, 1fr))
    }

    .grid-cols-7 {
      grid-template-columns: repeat(7, minmax(0, 1fr))
    }

    .flex-wrap {
      flex-wrap: wrap
    }

    .place-items-center {
      place-items: center
    }

    .items-end {
      align-items: flex-end
    }

    .items-center {
      align-items: center
    }

    .justify-start {
      justify-content: flex-start
    }

    .justify-end {
      justify-content: flex-end
    }

    .justify-center {
      justify-content: center
    }

    .justify-between {
      justify-content: space-between
    }

    .gap-1 {
      gap: 0.25rem
    }

    .gap-2 {
      gap: 0.5rem
    }

    .gap-3 {
      gap: 0.75rem
    }

    .gap-4 {
      gap: 1rem
    }

    .space-y-1> :not([hidden])~ :not([hidden]) {
      --tw-space-y-reverse: 0;
      margin-top: calc(0.25rem * calc(1 - var(--tw-space-y-reverse)));
      margin-bottom: calc(0.25rem * var(--tw-space-y-reverse))
    }

    .space-y-2> :not([hidden])~ :not([hidden]) {
      --tw-space-y-reverse: 0;
      margin-top: calc(0.5rem * calc(1 - var(--tw-space-y-reverse)));
      margin-bottom: calc(0.5rem * var(--tw-space-y-reverse))
    }

    .space-y-3> :not([hidden])~ :not([hidden]) {
      --tw-space-y-reverse: 0;
      margin-top: calc(0.75rem * calc(1 - var(--tw-space-y-reverse)));
      margin-bottom: calc(0.75rem * var(--tw-space-y-reverse))
    }

    .space-y-4> :not([hidden])~ :not([hidden]) {
      --tw-space-y-reverse: 0;
      margin-top: calc(1rem * calc(1 - var(--tw-space-y-reverse)));
      margin-bottom: calc(1rem * var(--tw-space-y-reverse))
    }

    .divide-y> :not([hidden])~ :not([hidden]) {
      --tw-divide-y-reverse: 0;
      border-top-width: calc(1px * calc(1 - var(--tw-divide-y-reverse)));
      border-bottom-width: calc(1px * var(--tw-divide-y-reverse))
    }

    .overflow-hidden {
      overflow: hidden
    }

    .rounded {
      border-radius: 0.25rem
    }

    .rounded-2xl {
      border-radius: 1rem
    }

    .rounded-full {
      border-radius: 9999px
    }

    .rounded-xl {
      border-radius: 0.75rem
    }

    .rounded-t {
      border-top-left-radius: 0.25rem;
      border-top-right-radius: 0.25rem
    }

    .border {
      border-width: 1px
    }

    .border-b {
      border-bottom-width: 1px
    }

    .border-t {
      border-top-width: 1px
    }

    .bg-amber-50 {
      --tw-bg-opacity: 1;
      background-color: rgb(255 251 235 / var(--tw-bg-opacity, 1))
    }

    .bg-slate-200 {
      --tw-bg-opacity: 1;
      background-color: rgb(226 232 240 / var(--tw-bg-opacity, 1))
    }

    .bg-white\/70 {
      background-color: rgb(255 255 255 / 0.7)
    }

    .bg-white\/80 {
      background-color: rgb(255 255 255 / 0.8)
    }

    .bg-white\/90 {
      background-color: rgb(255 255 255 / 0.9)
    }

    .bg-gradient-to-br {
      background-image: linear-gradient(to bottom right, var(--tw-gradient-stops))
    }

    .from-amber-50 {
      --tw-gradient-from: #fffbeb var(--tw-gradient-from-position);
      --tw-gradient-to: rgb(255 251 235 / 0) var(--tw-gradient-to-position);
      --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)
    }

    .from-cyan-50 {
      --tw-gradient-from: #ecfeff var(--tw-gradient-from-position);
      --tw-gradient-to: rgb(236 254 255 / 0) var(--tw-gradient-to-position);
      --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)
    }

    .from-green-50 {
      --tw-gradient-from: #f0fdf4 var(--tw-gradient-from-position);
      --tw-gradient-to: rgb(240 253 244 / 0) var(--tw-gradient-to-position);
      --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)
    }

    .from-rose-100 {
      --tw-gradient-from: #ffe4e6 var(--tw-gradient-from-position);
      --tw-gradient-to: rgb(255 228 230 / 0) var(--tw-gradient-to-position);
      --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)
    }

    .from-rose-50 {
      --tw-gradient-from: #fff1f2 var(--tw-gradient-from-position);
      --tw-gradient-to: rgb(255 241 242 / 0) var(--tw-gradient-to-position);
      --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)
    }

    .from-violet-50 {
      --tw-gradient-from: #f5f3ff var(--tw-gradient-from-position);
      --tw-gradient-to: rgb(245 243 255 / 0) var(--tw-gradient-to-position);
      --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)
    }

    .from-white {
      --tw-gradient-from: #fff var(--tw-gradient-from-position);
      --tw-gradient-to: rgb(255 255 255 / 0) var(--tw-gradient-to-position);
      --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)
    }

    .via-orange-100 {
      --tw-gradient-to: rgb(255 237 213 / 0) var(--tw-gradient-to-position);
      --tw-gradient-stops: var(--tw-gradient-from), #ffedd5 var(--tw-gradient-via-position), var(--tw-gradient-to)
    }

    .via-sky-50 {
      --tw-gradient-to: rgb(240 249 255 / 0) var(--tw-gradient-to-position);
      --tw-gradient-stops: var(--tw-gradient-from), #f0f9ff var(--tw-gradient-via-position), var(--tw-gradient-to)
    }

    .to-amber-100 {
      --tw-gradient-to: #fef3c7 var(--tw-gradient-to-position)
    }

    .to-emerald-50 {
      --tw-gradient-to: #ecfdf5 var(--tw-gradient-to-position)
    }

    .to-fuchsia-50 {
      --tw-gradient-to: #fdf4ff var(--tw-gradient-to-position)
    }

    .to-lime-50 {
      --tw-gradient-to: #f7fee7 var(--tw-gradient-to-position)
    }

    .to-sky-50 {
      --tw-gradient-to: #f0f9ff var(--tw-gradient-to-position)
    }

    .to-slate-50 {
      --tw-gradient-to: #f8fafc var(--tw-gradient-to-position)
    }

    .p-0 {
      padding: 0px
    }

    .p-3 {
      padding: 0.75rem
    }

    .p-4 {
      padding: 1rem
    }

    .px-2 {
      padding-left: 0.5rem;
      padding-right: 0.5rem
    }

    .px-3 {
      padding-left: 0.75rem;
      padding-right: 0.75rem
    }

    .py-1 {
      padding-top: 0.25rem;
      padding-bottom: 0.25rem
    }

    .py-2 {
      padding-top: 0.5rem;
      padding-bottom: 0.5rem
    }

    .text-center {
      text-align: center
    }

    .text-2xl {
      font-size: 1.5rem;
      line-height: 2rem
    }

    .text-3xl {
      font-size: 1.875rem;
      line-height: 2.25rem
    }

    .text-base {
      font-size: 1rem;
      line-height: 1.5rem
    }

    .text-sm {
      font-size: 0.875rem;
      line-height: 1.25rem
    }

    .text-xs {
      font-size: 0.75rem;
      line-height: 1rem
    }

    .font-bold {
      font-weight: 700
    }

    .font-extrabold {
      font-weight: 800
    }

    .font-medium {
      font-weight: 500
    }

    .font-semibold {
      font-weight: 600
    }

    .tabular-nums {
      --tw-numeric-spacing: tabular-nums;
      font-variant-numeric: var(--tw-ordinal) var(--tw-slashed-zero) var(--tw-numeric-figure) var(--tw-numeric-spacing) var(--tw-numeric-fraction)
    }

    .text-red-600 {
      --tw-text-opacity: 1;
      color: rgb(220 38 38 / var(--tw-text-opacity, 1))
    }

    .text-slate-500 {
      --tw-text-opacity: 1;
      color: rgb(100 116 139 / var(--tw-text-opacity, 1))
    }

    .text-slate-600 {
      --tw-text-opacity: 1;
      color: rgb(71 85 105 / var(--tw-text-opacity, 1))
    }

    .text-slate-700 {
      --tw-text-opacity: 1;
      color: rgb(51 65 85 / var(--tw-text-opacity, 1))
    }

    .text-slate-800 {
      --tw-text-opacity: 1;
      color: rgb(30 41 59 / var(--tw-text-opacity, 1))
    }

    .shadow {
      --tw-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
      --tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);
      box-shadow: var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)
    }

    .transition {
      transition-property: color, background-color, border-color, fill, stroke, opacity, box-shadow, transform, filter, -webkit-text-decoration-color, -webkit-backdrop-filter;
      transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter;
      transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter, -webkit-text-decoration-color, -webkit-backdrop-filter;
      transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
      transition-duration: 150ms
    }

    .hover\:shadow-xl:hover {
      --tw-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
      --tw-shadow-colored: 0 20px 25px -5px var(--tw-shadow-color), 0 8px 10px -6px var(--tw-shadow-color);
      box-shadow: var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)
    }

    @media (min-width: 640px) {
      .sm\:flex {
        display: flex
      }

      .sm\:h-56 {
        height: 14rem
      }

      .sm\:w-56 {
        width: 14rem
      }

      .sm\:min-w-\[520px\] {
        min-width: 520px
      }

      .sm\:grid-cols-2 {
        grid-template-columns: repeat(2, minmax(0, 1fr))
      }

      .sm\:grid-cols-3 {
        grid-template-columns: repeat(3, minmax(0, 1fr))
      }

      .sm\:justify-end {
        justify-content: flex-end
      }

      .sm\:p-4 {
        padding: 1rem
      }

      .sm\:p-5 {
        padding: 1.25rem
      }

      .sm\:p-6 {
        padding: 1.5rem
      }

      .sm\:text-3xl {
        font-size: 1.875rem;
        line-height: 2.25rem
      }

      .sm\:text-5xl {
        font-size: 3rem;
        line-height: 1
      }

      .sm\:text-base {
        font-size: 1rem;
        line-height: 1.5rem
      }

      .sm\:text-lg {
        font-size: 1.125rem;
        line-height: 1.75rem
      }

      .sm\:text-sm {
        font-size: 0.875rem;
        line-height: 1.25rem
      }
    }

    @media (min-width: 768px) {
      .md\:col-span-2 {
        grid-column: span 2 / span 2
      }

      .md\:grid-cols-2 {
        grid-template-columns: repeat(2, minmax(0, 1fr))
      }
    }
  </style>
  <style type="text/css">
    [mt_node=trans_loading]::after {
      content: '';
      vertical-align: middle !important;
      width: 1em !important;
      height: 1em !important;
      display: inline-block !important;
      margin: 0 4px !important;
      border: 2px rgba(0, 0, 0, 0.25) solid !important;
      border-top: 2px rgba(0, 0, 0, 1) solid !important;
      border-radius: 50% !important;
      padding: 0 !important;
      -webkit-animation: immersive-translate-loading-animation 0.6s infinite linear !important;
      animation: immersive-translate-loading-animation 0.6s infinite linear !important;
    }

    @keyframes immersive-translate-loading-animation {
      from {
        transform: rotate(0deg, 0deg, 0deg);
      }

      to {
        transform: rotate(359deg, 0deg, 0deg);
      }
    }
  </style>
  <style type="text/css">
    [mt_node^=trans] {
      display: none !important;
    }
  </style>
</head>

<body class="min-h-screen bg-gradient-to-br text-slate-800 from-rose-50 via-sky-50 to-emerald-50">


  <div class="max-w-6xl mx-auto p-3 sm:p-6">

    <!-- æ ‡é¢˜ -->
    <header class="flex items-center justify-between mb-4">
      <h1 class="text-2xl sm:text-3xl font-extrabold select-none cursor-pointer" id="appTitle">
        ğŸ… è¯·åƒå°ç•ªèŒ„ï¼</h1>
      <div class="flex items-center gap-2 text-sm">
        <span class="inline-flex items-center gap-1 border rounded px-2 py-1"><span>ğŸª™</span><span
            id="pointBadge">0</span></span>

        <!-- è®¾ç½® -->

        <button class="items-center gap-1 border rounded px-2 py-1 inline-flex" id="devBtn">
          âš™ è®¾ç½®</button>
      </div>
    </header>

    <!-- é¦–é¡µ -->
    <main class="hiiden space-y-4" id="view-home">

      <!-- ç•ªèŒ„é—¹é’Ÿ -->
      <section
        class="overflow-hidden border rounded-xl shadow bg-gradient-to-br from-rose-100 via-orange-100 to-amber-100">
        <div class="p-3 sm:p-4 border-b grid grid-cols-2 gap-3 items-center justify-between sm:grid">
          <div class="font-semibold mb-1 sm:text-lg">â±ï¸ ç•ªèŒ„é—¹é’Ÿ</div>
          <div class="font-semibold mb-1 sm:text-lg justify-self-end border rounded" data-link="help">â“ å¸®åŠ©</div>
        </div>
        <div class="p-3 sm:p-5 grid grid-cols-1 sm:grid-cols-2 gap-4 items-center">
          <div class="flex items-center justify-center">
            <div class="relative w-52 h-52 sm:w-56 sm:h-56">
              <div class="absolute inset-0 rounded-full" id="quickRing"
                style="background:conic-gradient(#fb7185 0deg, rgba(255,255,255,0.6) 0deg)"></div>
              <div class="absolute inset-3 rounded-full bg-white/80 shadow flex items-center justify-center border">
                <div class="text-center">
                  <div class="text-4xl sm:text-5xl font-extrabold tabular-nums" id="quickClock">25:00</div>
                  <div class="mt-1 text-xs sm:text-sm" id="quickPhase">ä¸“æ³¨ä¸­ ğŸ”¥</div>
                  <div class="mt-1 text-xs sm:text-sm" id="quickLoopsStatus">å¾ªç¯ï¼š0/4</div>
                </div>
              </div>
            </div>
          </div>
          <div class="space-y-3 text-sm sm:text-base ">
            <!-- ç•ªèŒ„é—¹é’Ÿè®¾ç½® -->
            <div class="grid grid-cols-3 gap-3">
              <label class="block">
                <span class="block mb-2 text-cente">â³ å·¥ä½œ/min</span>
                <input class="w-full border rounded px-2 py-1" id="quickWork" min="0.1" type="number" value="25">
              </label>
              <label class="block">
                <span class="block mb-2 text-cente">â˜• ä¼‘æ¯/min</span>
                <input class="w-full border rounded px-2 py-1" id="quickBreak" min="0.1" type="number" value="5">
              </label>
              <label class="block">
                <span class="block mb-2 text-center">ğŸ” å¾ªç¯æ¬¡æ•°</span>
                <input class="w-full border rounded px-2 py-1" id="quickLoops" min="1" type="number" value="4"></label>
            </div>

            <!-- å®Œæˆæ˜¾ç¤º -->

            <div
              class="grid grid-cols-2 gap-4 sm:p-4 gird grid-cols-2 flex-wrap items-center gap-2 text-sm sm:text-base">
              <div class="inline-flex border items-center justify-center rounded px-2 py-1" id="todayCount">ä»Šæ—¥å·²å®Œæˆï¼š0
              </div>
              <div class="inline-flex border items-center justify-center rounded px-2 py-1" id="consecBadge">å½“å‰ç•ªèŒ„é’Ÿè¿ç»­ï¼š0
              </div>
            </div>

            <!-- ä¸‹æ¬¡è·å¾— -->
            <div class="block">
              <span class="bg-white/70 w-full inline-flex flex-col items-center border rounded px-2 py-1">
                <span class="mb-2 ">ğŸª™ ä¸‹æ¬¡è·å¾—ï¼š</span>
                <span id="quickPoints">0</span>
              </span>
            </div>

            <div class="flex flex-wrap grid grid-cols-2 gap-2">
              <button class="border rounded px-3 py-2 " id="quickStart">â–¶ï¸ å¼€å§‹</button>
              <button class="border rounded px-3 py-2 hidden" id="quickPause">â¸ï¸ æš‚åœ</button>
              <button class="border rounded px-3 py-2" id="quickReset">â®ï¸ é‡ç½®</button>
            </div>

          </div>
        </div>
      </section>

      <!-- å…¶ä»–æ¨¡å— -->
      <section class="grid gap-4 grid-cols-2 sm:grid-cols-1">

        <a class="block border rounded-xl hover:shadow-xl transition bg-gradient-to-br from-amber-50 to-lime-50"
          data-link="sign">
          <div class="px-4 py-3">
            <div class="py-2 border-b mb-1">
              <div class="font-semibold sm:text-lg">ğŸ“… ç­¾åˆ°</div>
            </div>
            <p class="py-2 text-sm">æ¯æ—¥ç­¾åˆ°ï¼Œè¿ç»­è¶Šå¤šå¥–åŠ±è¶Šé«˜</p>
          </div>
        </a>

        <a class="block border rounded-xl hover:shadow-xl transition bg-gradient-to-br from-cyan-50 to-sky-50"
          data-link="lottery">
          <div class="px-4 py-3">
            <div class="py-2 border-b mb-1">
              <div class="font-semibold sm:text-lg">ğŸ° ä¸€ç•ªèµ</div>
            </div>
            <p class="py-2 text-sm">æ¶ˆè€— 300 ğŸª™ï¼Œå¯è‡ªå®šä¹‰</p>
          </div>
        </a>

        <a class="block border rounded-xl hover:shadow-xl transition bg-gradient-to-br from-violet-50 to-fuchsia-50"
          data-link="stats">
          <div class="px-4 py-3">
            <div class="py-2 border-b mb-1">
              <div class="font-semibold sm:text-lg">ğŸ“ˆ ç»Ÿè®¡</div>
            </div>
            <p class="py-2 text-sm">æŒ‰å°æ—¶/å‘¨/æœˆæŸ¥çœ‹å®Œæˆé‡</p>
          </div>
        </a>

        <a class="block border rounded-xl hover:shadow-xl transition bg-gradient-to-br from-green-50 to-emerald-50"
          data-link="ledger">
          <div class="px-4 py-3">
            <div class="py-2 border-b mb-1">
              <div class="font-semibold sm:text-lg">ğŸ“’ ç§¯åˆ†è®°å½•</div>
            </div>
            <p class="py-2 text-sm">æŸ¥çœ‹ç§¯åˆ†æ”¶æ”¯å†å²</p>
          </div>
        </a>

      </section>



    </main>

    <!-- å¸®åŠ©é¡µ -->
    <section class="hidden" id="view-help">
      <div class="mb-3">
        <button class="border rounded px-3 py-2" data-home="">ğŸ  è¿”å›é¦–é¡µ</button>
      </div>
      <div class="border rounded-xl">
        <div class="p-3 border-b font-semibold">â“ å¸®åŠ©</div>
        <div class="p-4 text-sm space-y-4">
          <div>
            <h2 class="font-semibold mb-2">ğŸ’¡ æœ¬ç½‘ç«™åŠŸèƒ½</h2>
            <p>åŸºäºä¸€ç•ªèµæŠ½å¥–ç³»ç»Ÿçš„ç•ªèŒ„é—¹é’Ÿæ¿€åŠ±å­¦ä¹ </p>
          </div>
          <div>
            <h2 class="font-semibold mb-2">ğŸ’¡ è·å¾—ğŸª™çš„æ–¹å¼ï¼Ÿ</h2>
            <p>ç§¯åˆ†å¯ä»¥é€šè¿‡å®Œæˆç•ªèŒ„é’Ÿå’Œç­¾åˆ°è·å¾—ï¼Œå¹¶ä¸”éƒ½æœ‰è¿ç»­å¥–åŠ±æœºåˆ¶ã€‚</p>
            <h3 class="font-semibold mb-1">ç•ªèŒ„é—¹é’Ÿçš„å¥–åŠ±æœºåˆ¶å¦‚ä¸‹ï¼š</h3>
            <p>â‘ æ¯å®Œæˆä¸€ä¸ªé—¹é’Ÿï¼Œå¥–åŠ±50ç§¯åˆ†ï¼Œè¿ç»­å®Œæˆnä¸ªé—¹é’Ÿåˆ™é¢å¤–å¥–åŠ±(n-1)^2*5ä¸ªç§¯åˆ†ï¼›</p>
            <p>â‘¡æ¯å®Œæˆä¸€ä¸ªé—¹é’Ÿï¼Œæœ‰5%çš„æ¦‚ç‡é¢å¤–å¥–åŠ±100ï¼Œæœ‰10%çš„æ¦‚ç‡å¥–åŠ±10ï¼›</p>
            <p>â‘¢å½“å¤©å®Œå®Œæˆé—¹é’Ÿæ€»æ•°ä¸ºiï¼Œi=3æ—¶é¢å¤–å¥–åŠ±25ï¼Œi=6æ—¶é¢å¤–å¥–åŠ±75ï¼Œi=8æ—¶è€Œå¤–å¥–åŠ±100ã€‚</p>
          </div>
          <div>
            <h2 class="font-semibold mb-2">ğŸ’¡å¦‚ä½•æŠ½å¥–ï¼Ÿ</h2>
            <p>è¿›å…¥â€œä¸€ç•ªèµâ€é¡µé¢ï¼Œæ¶ˆè€— 300 ç§¯åˆ†å³å¯è¿›è¡ŒæŠ½å¥–ã€‚</p>
          </div>
          <div>
            <h2 class="font-semibold mb-2">ğŸ’¡å…¶ä»–é—®é¢˜/å»ºè®®</h2>
            <p>å¦‚æœ‰å…¶ä»–é—®é¢˜/å»ºè®®ï¼Œè¯·è”ç³»å¼€å‘è€…ã€‚</p>
          </div>
        </div>
      </div>
    </section>

    <!-- ç­¾åˆ°é¡µ -->
    <section class="hidden" id="view-sign">
      <div class="mb-3"><button class="border rounded px-3 py-2" data-home="">ğŸ  è¿”å›é¦–é¡µ</button></div>
      <div class="border rounded-xl">
        <div class="p-3 border-b font-semibold">ğŸ“… ç­¾åˆ°ç³»ç»Ÿ</div>
        <div class="p-4 space-y-3">

          <div class="flex gap-2 items-center grid flex-wrap text-sm">
            <span class="inline-flex items-center border rounded px-2 py-1" id="signLast">ä¸Šæ¬¡ç­¾åˆ°ï¼šâ€”</span>
            <span class="inline-flex items-center border rounded px-2 py-1" id="signStreak">è¿ç»­ï¼š0 å¤©ï¼ˆä¸Šé™ 30ï¼‰</span>
            <span class="inline-flex items-center border rounded px-2 py-1" id="signTotal">ç´¯è®¡ç­¾åˆ°ï¼š0 å¤©</span>
          </div>

          <button class="border rounded px-2 py-2" id="btnSign">âœ’ ä»Šæ—¥ç­¾åˆ°</button>

          <div class="border rounded p-3">
            <div class="font-semibold mb-2">è§„åˆ™</div>
            <li class="text-sm text-slate-600 mb-1">æ¯å¤©ç­¾åˆ°1æ¬¡ï¼Œè·å¾— <b>10</b> é‡‘å¸</li>
            <li class="text-sm text-slate-600">è‹¥è¿ç»­ j å¤©åˆ™è·å¾— <b>jx10 </b> é‡‘å¸ï¼ˆjä¸Šé™30ï¼‰</li>
          </div>

          <div class="border rounded p-3 mt-3">
            <div class="flex items-center justify-between mb-2">
              <button class="border rounded px-2 py-1 text-sm" id="calPrev">â† ä¸Šæœˆ</button>
              <div class="font-semibold" id="calTitle">2025 å¹´ 10 æœˆ</div>
              <button class="border rounded px-2 py-1 text-sm" id="calNext">ä¸‹æœˆ â†’</button>
            </div>
            <div class="grid grid-cols-7 text-center text-xs text-slate-500">
              <div class="py-1">æ—¥</div>
              <div class="py-1">ä¸€</div>
              <div class="py-1">äºŒ</div>
              <div class="py-1">ä¸‰</div>
              <div class="py-1">å››</div>
              <div class="py-1">äº”</div>
              <div class="py-1">å…­</div>
            </div>
            <div class="grid grid-cols-7 gap-1 text-sm" id="calGrid">
              <div class="cal-cell muted">
                <div class="day">28</div>
                <div class="mark"></div>
              </div>
              <div class="cal-cell muted">
                <div class="day">29</div>
                <div class="mark"></div>
              </div>
              <div class="cal-cell muted">
                <div class="day">30</div>
                <div class="mark"></div>
              </div>
              <div class="cal-cell">
                <div class="day">1</div>
                <div class="mark"></div>
              </div>
              <div class="cal-cell">
                <div class="day">2</div>
                <div class="mark"></div>
              </div>
              <div class="cal-cell">
                <div class="day">3</div>
                <div class="mark"></div>
              </div>
              <div class="cal-cell">
                <div class="day">4</div>
                <div class="mark"></div>
              </div>
              <div class="cal-cell">
                <div class="day">5</div>
                <div class="mark"></div>
              </div>
              <div class="cal-cell">
                <div class="day">6</div>
                <div class="mark">â€¢</div>
              </div>
              <div class="cal-cell">
                <div class="day">7</div>
                <div class="mark"></div>
              </div>
              <div class="cal-cell">
                <div class="day">8</div>
                <div class="mark"></div>
              </div>
              <div class="cal-cell">
                <div class="day">9</div>
                <div class="mark"></div>
              </div>
              <div class="cal-cell">
                <div class="day">10</div>
                <div class="mark"></div>
              </div>
              <div class="cal-cell">
                <div class="day">11</div>
                <div class="mark"></div>
              </div>
              <div class="cal-cell">
                <div class="day">12</div>
                <div class="mark"></div>
              </div>
              <div class="cal-cell">
                <div class="day">13</div>
                <div class="mark"></div>
              </div>
              <div class="cal-cell">
                <div class="day">14</div>
                <div class="mark"></div>
              </div>
              <div class="cal-cell">
                <div class="day">15</div>
                <div class="mark"></div>
              </div>
              <div class="cal-cell">
                <div class="day">16</div>
                <div class="mark"></div>
              </div>
              <div class="cal-cell">
                <div class="day">17</div>
                <div class="mark"></div>
              </div>
              <div class="cal-cell">
                <div class="day">18</div>
                <div class="mark"></div>
              </div>
              <div class="cal-cell">
                <div class="day">19</div>
                <div class="mark"></div>
              </div>
              <div class="cal-cell">
                <div class="day">20</div>
                <div class="mark"></div>
              </div>
              <div class="cal-cell">
                <div class="day">21</div>
                <div class="mark"></div>
              </div>
              <div class="cal-cell">
                <div class="day">22</div>
                <div class="mark"></div>
              </div>
              <div class="cal-cell">
                <div class="day">23</div>
                <div class="mark"></div>
              </div>
              <div class="cal-cell">
                <div class="day">24</div>
                <div class="mark"></div>
              </div>
              <div class="cal-cell">
                <div class="day">25</div>
                <div class="mark"></div>
              </div>
              <div class="cal-cell">
                <div class="day">26</div>
                <div class="mark"></div>
              </div>
              <div class="cal-cell">
                <div class="day">27</div>
                <div class="mark"></div>
              </div>
              <div class="cal-cell">
                <div class="day">28</div>
                <div class="mark"></div>
              </div>
              <div class="cal-cell">
                <div class="day">29</div>
                <div class="mark"></div>
              </div>
              <div class="cal-cell">
                <div class="day">30</div>
                <div class="mark"></div>
              </div>
              <div class="cal-cell">
                <div class="day">31</div>
                <div class="mark"></div>
              </div>
              <div class="cal-cell muted">
                <div class="day">1</div>
                <div class="mark"></div>
              </div>
              <div class="cal-cell muted">
                <div class="day">2</div>
                <div class="mark"></div>
              </div>
              <div class="cal-cell muted">
                <div class="day">3</div>
                <div class="mark"></div>
              </div>
              <div class="cal-cell muted">
                <div class="day">4</div>
                <div class="mark"></div>
              </div>
              <div class="cal-cell muted">
                <div class="day">5</div>
                <div class="mark"></div>
              </div>
              <div class="cal-cell muted">
                <div class="day">6</div>
                <div class="mark"></div>
              </div>
              <div class="cal-cell muted">
                <div class="day">7</div>
                <div class="mark"></div>
              </div>
              <div class="cal-cell muted">
                <div class="day">8</div>
                <div class="mark"></div>
              </div>
            </div>
            <div class="text-xs text-slate-500 mt-2">âœ… è¡¨ç¤ºå½“æ—¥å·²ç­¾åˆ°ï¼›å¯å·¦å³åˆ‡æ¢æœˆä»½æŸ¥çœ‹å†å²ã€‚</div>
          </div>
          <div class="border rounded p-3 mt-3">
            <div class="font-semibold mb-1">è¿ç»­ç»Ÿè®¡</div>
            <div class="text-sm space-y-1">
              <div id="streakMax">æœ€é•¿è¿ç»­ï¼šâ€”</div>
              <div class="text-slate-600 text-xs" id="streakBreaks">æ–­ç‚¹ï¼šæ— </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- æŠ½å¥–é¡µ -->
    <section class="hidden" id="view-lottery">
      <div class="mb-3"><button class="border rounded px-3 py-2" data-home="">ğŸ  è¿”å›é¦–é¡µ</button></div>
      <div class="grid md:grid-cols-2 gap-4">
        <div class="border rounded-xl">
          <div class="p-3 border-b font-semibold">ğŸ° ä¸€ç•ªèµ</div>
          <div class="p-4 space-y-4">
            <div class="flex items-center gap-2">
              <span class="inline-flex items-center border rounded px-2 py-1">300 ğŸª™/æ¬¡</span>
              <span class="inline-flex items-center border rounded px-2 py-1">A 3% / B 8.5% / C88.5%</span>
            </div>
            <div
              class="h-48 rounded-2xl bg-gradient-to-br from-white to-slate-50 border relative grid place-items-center perspective">
              <div class="w-64 h-36 preserve-3d flip-card" id="flipWrap">
                <div
                  class="absolute inset-0 rounded-xl bg-white/90 border shadow grid place-items-center backface-hidden">
                  <span class="text-2xl select-none">â“ ç‚¹å‡»å¼€å§‹ç¿»ç‰Œ</span>
                </div>
                <div
                  class="absolute inset-0 rounded-xl bg-amber-50 border shadow grid place-items-center backface-hidden rotate-y-180">
                  <div class="text-center space-y-2 hidden" id="lotteryResult">
                    <div class="text-sm text-slate-500">æ­å–œè·å¾—</div>
                    <div class="text-2xl font-bold flex items-center justify-center gap-2">
                      <span>ğŸ‘‘</span>
                      <span id="lotteryPrize">â€”</span>
                      <span class="inline-flex items-center border rounded px-2 py-1" id="lotteryTier">Aèµ</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="flex gap-2">
              <button class="border rounded px-3 py-2" id="btnDraw">å¼€å§‹æŠ½å¥–</button>
              <button class="border rounded px-3 py-2" id="btnPool">è®¾ç½®å¥–æ± </button>
              <button class="border rounded px-3 py-2" id="btnLotteryLog">ğŸ“’ æŠ½å¥–è®°å½•</button>
            </div>
            <div class="mt-3 border rounded-xl bg-white/70 p-3 hidden" id="lotteryLogPanel">
              <div class="flex items-center justify-between mb-2">
                <div class="font-semibold">æŠ½å¥–è®°å½•</div><button class="border rounded px-2 py-1 text-sm"
                  id="btnLotteryLogClose">å…³é—­</button>
              </div>
              <div class="flex text-xs font-medium bg-slate-200 text-slate-700 rounded-t" id="lotteryLogHeader">
                <div class="flex-1 py-2 text-center">æ—¶é—´</div>
                <div class="flex-1 py-2 text-center">å¥–é¡¹</div>
                <div class="flex-1 py-2 text-center">å¥–å“</div>
              </div>
              <div class="text-sm" id="lotteryLogList"></div>
            </div>
          </div>
        </div>
        <div class="border rounded-xl">
          <div class="p-3 border-b font-semibold">è¯´æ˜</div>
          <div class="p-4 text-sm text-slate-600 space-y-2">
            <li class="text-sm text-slate-600 mb-1">å…ˆæŒ‰ A/B/C æ¦‚ç‡å†³å®šç±»åˆ«ï¼Œå†åœ¨è¯¥ç±»å†…ç­‰æ¦‚ç‡é€‰æ‹©ä¸€ä¸ªå¥–å“ã€‚</li>
            <li class="text-sm text-slate-600 mb-1">Aèµ3% ï½œ Bèµ8.5% ï½œ Cèµ88.5%ã€‚ç±»å†…å¥–å“å¯è‡ªå®šä¹‰ï¼Œä¸ªæ•°ä¸é™ï¼Œæ¦‚ç‡è‡ªåŠ¨å‡åˆ†ã€‚</li>
            </li>
          </div>
        </div>
      </div>
    </section>

    <!-- å…¬å‘Šé¡µï¼ˆè§„åˆ™ï¼‰ -->
    <section class="hidden" id="view-notice">
      <div class="mb-3"><button class="border rounded px-3 py-2" data-home="">ğŸ  è¿”å›é¦–é¡µ</button></div>
      <div class="border rounded-xl">
        <div class="p-3 border-b font-semibold">ğŸ“œ å…¬å‘Šä¸è§„åˆ™</div>
        <div class="p-4 text-sm">
          <p>è§é¦–é¡µä¸å„åŠŸèƒ½é¡µè¯´æ˜ã€‚</p>
        </div>
      </div>
    </section>

    <!-- ç»Ÿè®¡é¡µ -->
    <section class="hidden" id="view-stats">
      <div class="mb-3"><button class="border rounded px-3 py-2" data-home="">ğŸ  è¿”å›é¦–é¡µ</button></div>
      <div class="grid md:grid-cols-2 gap-4">
        <div class="border rounded-xl">
          <div class="p-3 border-b font-semibold">å½“æ—¥ Â· æŒ‰å°æ—¶</div>
          <div class="p-4 h-[260px]"><canvas id="chartHour"></canvas></div>
        </div>
        <div class="border rounded-xl">
          <div class="p-3 border-b font-semibold">æœ€è¿‘ 7 å¤©</div>
          <div class="p-4 h-[260px]"><canvas id="chart7"></canvas></div>
        </div>
        <div class="border rounded-xl md:col-span-2">
          <div class="p-3 border-b font-semibold">å½“æœˆ</div>
          <div class="p-4 h-[260px]"><canvas id="chartMonth"></canvas></div>
        </div>
        <div class="border rounded-xl md:col-span-2">
          <div class="p-3 border-b font-semibold">ç§¯åˆ†æ”¶æ”¯ä¸æ¥æº</div>
          <div class="p-4 h-[260px]"><canvas id="chartLedger"></canvas></div>
        </div>
      </div>
    </section>



    <!-- ç§¯åˆ†æ”¶æ”¯å†å² -->
    <section class="hidden" id="view-ledger">
      <div class="mb-3"><button class="border rounded px-3 py-2" data-home="">ğŸ  è¿”å›é¦–é¡µ</button></div>
      <div class="border rounded-xl bg-white/70 p-3">
        <div class="flex items-center justify-between mb-2">
          <div class="font-semibold">ç§¯åˆ†æ”¶æ”¯å†å²</div>
        </div>
        <div class="mb-2 grid grid-cols-1 sm:grid-cols-2 gap-2" id="ledgerToolbar">
          <div class="flex flex-wrap items-center gap-2 text-sm"><label
              class="flex items-center gap-2"><span>æ¥æº</span><select class="border rounded px-2 py-1" id="ledgerFilter">
                <option value="ALL">å…¨éƒ¨</option>
              </select></label><label class="flex items-center gap-2"><span>æ—¶é—´</span><select
                class="border rounded px-2 py-1" id="timeRange">
                <option value="ALL">å…¨éƒ¨</option>
                <option value="LAST7">æœ€è¿‘7å¤©</option>
                <option value="MONTH">æœ¬æœˆ</option>
                <option value="CUSTOM">è‡ªå®šä¹‰</option>
              </select></label>
            <div class="hidden items-center gap-2" id="customDates"><input class="border rounded px-2 py-1"
                id="dateFrom" type="date"><input class="border rounded px-2 py-1" id="dateTo" type="date"></div>
          </div>
          <div class="flex flex-wrap items-center gap-2 justify-start sm:justify-end text-sm"><label
              class="flex items-center gap-2"><span>æ’åº</span><select class="border rounded px-2 py-1" id="sortField">
                <option value="time">æ—¶é—´</option>
                <option value="delta">å˜åŠ¨</option>
              </select><select class="border rounded px-2 py-1" id="sortOrder">
                <option value="desc">é™åº</option>
                <option value="asc">å‡åº</option>
              </select></label><button class="border rounded px-3 py-2" id="exportCSV">â¬‡ï¸ å¯¼å‡º CSV</button></div>
        </div>
        <div class="mb-2 flex items-center gap-2 text-sm"><label
            class="flex items-center gap-2"><span>æ¥æºç­›é€‰</span></label></div>
        <div class="flex text-xs font-medium bg-slate-200 text-slate-700 rounded-t" id="ledgerHeader">
          <div class="flex-1 text-center flex-1 py-2 text-center">æ—¶é—´</div>
          <div class="flex-1 text-center flex-1 py-2 text-center">é¡¹ç›®</div>
          <div class="flex-1 text-center flex-1 py-2 text-center">å˜åŠ¨</div>
        </div>
        <div class="text-sm divide-y" id="ledgerList"></div>
        <div class="text-xs text-slate-500 mt-1">æœ€è¿‘è®°å½•åœ¨ä¸Šï¼›æ­£æ•°ä¸ºè·å¾—ç§¯åˆ†ï¼Œè´Ÿæ•°ä¸ºæ¶ˆè€—ã€‚</div>
      </div>
    </section>

    <!-- ç®¡ç†é¢æ¿ -->
    <section class="hidden" id="view-dev">
      <div class="mb-3"><button class="border rounded px-3 py-2" data-home="">ğŸ  è¿”å›é¦–é¡µ</button></div>
      <div class="border rounded-xl mb-5">
        <div class="p-3 border-b font-semibold">âš™ è®¾ç½®</div>

        <!-- é¢œè‰²è°ƒæ•´ -->
        <div class="mb-5">
          <div class="p-3 space-y-4">
            <div class="border rounded p-4 bg-white/70">
              <div class="py-1 font-semibold mb-2">ğŸ“Œ å¤–è§‚å’Œå£°éŸ³</div>
              <div class="border-b mb-4 "></div>
              <div class="flex flex-col items-center gap-4">
                <div class="border rounded p-2 flex items-center gap-4 mb-2">
                  <span>ğŸ¨ ä¸»é¢˜</span>
                  <select class="border rounded px-2 py-1" id="themeSelect">
                    <option value="sunset">æ—¥è½</option>
                    <option value="ocean">æµ·æ´‹</option>
                    <option value="aurora">æå…‰</option>
                    <option value="candy">ç³–æœ</option>
                    <option value="mono">æŸ”ç°</option>
                  </select>
                </div>
                <div class="border rounded p-2 flex items-center gap-11">
                  <span>ğŸ”Š å£°éŸ³å¼€å…³</span>
                  <label class="flex items-center">
                    <input checked="" id="soundToggle" type="checkbox">
                  </label>
                </div>
              </div>
            </div>
          </div>
          <div class="border-b mb-4"></div>




          <!-- å¼€å‘è€…æ¨¡å¼ -->
          <div class="mb-5">
            <div class="p-3 space-y-4">
              <div class="border rounded p-4 bg-white/70">
                <div class="py-1 font-semibold mb-2">ğŸ”§ å¼€å‘è€…æ¨¡å¼</div>
                <div class="border-b mb-4"></div>
                <div id="devStatus" class=" p-2 text-sm text-slate-600 flex items-center justify-between">
                  <span id="devStatusText" class="text-red-600">ğŸ”’ æœªè§£é”å¼€å‘è€…æ¨¡å¼ï¼Œä»¥ä¸‹åŠŸèƒ½ä¸å¯ä½¿ç”¨ã€‚</span>
                  <button id="devLockBtn" class="border rounded px-3 py-1 text-red-600 hidden">å…³é—­å¼€å‘è€…æ¨¡å¼</button>
                </div>
                <div class="grid sm:grid-cols-3 gap-3 mt-4">
                  <label class="block">
                    <span class="block mb-1">è°ƒæ•´ç§¯åˆ†ï¼ˆå¯æ­£å¯è´Ÿï¼‰</span>
                    <input class="w-full border rounded px-2 py-1" id="devPts" type="number" value="0">
                  </label>
                  <label class="block">
                    <span class="block mb-1">è¿½åŠ ç•ªèŒ„å®Œæˆè®°å½•æ•°é‡</span>
                    <input class="w-full border rounded px-2 py-1 " id="devPomos" min="0" type="number" value="0">
                  </label>
                  <div class="flex justify-center items-end">
                    <button class="border rounded px-3 py-2" id="devApply">
                      åº”ç”¨æ›´æ”¹
                    </button>
                  </div>
                </div>
                <div class="border rounded p-3 text-sm text-slate-600 mt-4">
                  <div class="font-semibold mb-2">âš ï¸ è­¦å‘Š</div>
                  <p>å¼€å‘è€…æ¨¡å¼ä»…ä¾›æµ‹è¯•ä¸è°ƒè¯•ä½¿ç”¨ï¼Œæ»¥ç”¨å¯èƒ½å¯¼è‡´æ•°æ®å¼‚å¸¸æˆ–ä¸å¯é¢„æœŸçš„è¡Œä¸ºã€‚</p>
                  <p>è¯·è°¨æ…æ“ä½œï¼Œå»ºè®®åœ¨æ“ä½œå‰å¤‡ä»½æ•°æ®ã€‚</p>
                </div>
              </div>
            </div>
          </div>
          <div class="border-b mb-4"></div>

          <!-- å…³äº -->
          <div class="mb-2">
            <div class="p-3 space-y-2">
              <div class="border rounded p-4 bg-white/70">
                <div class="py-1 font-semibold mb-2">â“ å…³äº</div>
                <div class="border-b mb-4"></div>
                <div class="text-sm text-slate-600 space-y-2">
                  <div>åç§°ï¼šè¯·åƒå°ç•ªèŒ„/TomatoBites</span></div>
                  <div>ç‰ˆæœ¬ï¼šv1.0.0</span></div>
                  <div>ä½œè€…ï¼šç©ºæ¸¯</div>
                  <div>
                    é…å¸ƒï¼š
                    <a class="text-blue-600 underline" href="https://github.com/karakarakarakan/TomatoBites"
                      target="_blank" rel="noopener">
                      TomatoBites
                    </a>
                  </div>

                </div>
              </div>
            </div>
          </div>
          <div class="border-b mb-4"></div>

          <!-- æ¸…ç©ºæ•°æ® -->
          <div class="flex justify-center mt-3 mb-3 ">
            <button class="border rounded px-3 py-2 text-red-600 " id="devClear">
              ğŸ—‘ï¸ æ¸…ç©ºæœ¬åœ°æ•°æ®
            </button>
          </div>

        </div>
    </section>

    <!-- é¡µè„š -->
    <footer class="mt-10 text-center text-sm text-slate-500">Â© <span id="year">2025</span> ğŸ…è¯·åƒå°ç•ªèŒ„/TomatoBites</footer>

  </div>

  <!-- å¥–æ± è®¾ç½®å¼¹çª— -->
  <dialog class="rounded-xl p-0" id="poolDialog">
    <form class="min-w-[320px] sm:min-w-[520px]" method="dialog">
      <div class="p-3 border-b font-semibold">è®¾ç½®å¥–æ± ï¼ˆç±»å†…å‡åŒ€ï¼‰</div>
      <div class="p-3 grid sm:grid-cols-3 gap-3 text-sm">
        <label class="block"><span class="block mb-1">A èµï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</span><textarea class="w-full border rounded px-2 py-1"
            id="poolA" rows="8"></textarea></label>
        <label class="block"><span class="block mb-1">B èµï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</span><textarea class="w-full border rounded px-2 py-1"
            id="poolB" rows="8"></textarea></label>
        <label class="block"><span class="block mb-1">C èµï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</span><textarea class="w-full border rounded px-2 py-1"
            id="poolC" rows="8"></textarea></label>
      </div>
      <div class="p-3 flex justify-end gap-2 border-t">
        <button class="border rounded px-3 py-2" value="cancel">å–æ¶ˆ</button>
        <button class="border rounded px-3 py-2" id="poolSave">ä¿å­˜</button>
      </div>
    </form>
  </dialog>

  <!-- è‡ªå®šä¹‰æç¤ºå¼¹çª— -->
  <div id="customAlert" class="fixed inset-0 bg-black/30 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-xl p-5 shadow text-center min-w-[200px]">
      <div id="customAlertMsg" class="mb-3"></div>
      <button id="customAlertBtn" class="border rounded px-4 py-2 bg-amber-50">ç¡®å®š</button>
    </div>
  </div>

  <!-- å¼€å‘è€…æ¨¡å¼å¯†ç å¼¹çª— -->
  <div id="devPwdDialog" class="fixed inset-0 bg-black/30 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-xl p-5 shadow text-center min-w-[220px]">
      <div class="mb-3 font-semibold">è¯·è¾“å…¥å¼€å‘è€…æ¨¡å¼å¯†ç </div>
      <input id="devPwdInput" type="password" class="border rounded px-3 py-2 w-full mb-3" placeholder="å¯†ç ">
      <div class="flex justify-center gap-3">
        <button id="devPwdCancel" class="border rounded px-4 py-2 bg-slate-200">å–æ¶ˆ</button>
        <button id="devPwdOk" class="border rounded px-4 py-2 bg-amber-50">ç¡®å®š</button>
      </div>
    </div>
  </div>


  <!-- è„šæœ¬ -->
  <script>
    // =============== å·¥å…·ä¸çŠ¶æ€ ===============
    const LS_KEY = 'pomox_app_state_html_v1';
    const now = () => Date.now();
    const todayKey = (d = new Date()) => d.toISOString().slice(0, 10);
    const startOfDay = (ts) => { const d = new Date(ts); d.setHours(0, 0, 0, 0); return d.getTime(); }
    const startOfMonth = (ts) => { const d = new Date(ts); d.setHours(0, 0, 0, 0); d.setDate(1); return d.getTime(); }
    const clamp = (n, min, max) => Math.min(max, Math.max(min, n));
    const randomChoice = (arr) => arr[Math.floor(Math.random() * arr.length)];

    const SCORE_SRC = {
      POMO_BASE: 'å®Œæˆç•ªèŒ„+50',
      POMO_CONSEC: 'è¿ç»­å®Œæˆå¥–åŠ±',
      POMO_RANDOM_100: 'éšæœº+100(5%)',
      POMO_RANDOM_10: 'éšæœº+10(10%)',
      DAILY_MILESTONE: 'å½“æ—¥é‡Œç¨‹ç¢‘',
      SIGNIN: 'ç­¾åˆ°',
      ADJUST: 'å¼€å‘è€…è°ƒæ•´',
      LOTTERY_COST: 'æŠ½å¥–æ¶ˆè€—',
    };

    const defaultState = {
      settings: { sound: true, volume: 0.7, theme: 'sunset' },
      points: 0,
      pomodoros: [], // { finishedAt }
      sign: { lastDate: '', streak: 0, totalDays: 0, history: [] },
      dayMilestones: { date: '', hits: [] },
      currentConsec: 0,
      devUnlocked: false,
      lottery: { A: ['ç¨€æœ‰å¾½ç« ', 'é™å®šçš®è‚¤', 'åƒé¡¿å¤§é¤'], B: ['ä¹°æœ¬ä¹¦', 'çœ‹åœºç”µå½±', 'åŒå€å¡(1æ¬¡)'], C: ['ç”œéº»è–¯1ä¸ª', 'è€ä¼šå„¿æ‰‹æœº', 'è´´çº¸'] },
      lotteryLog: [],
      ledger: [], // {ts, delta, reason, meta}
    };

    function load() { try { const raw = localStorage.getItem(LS_KEY); return raw ? { ...defaultState, ...JSON.parse(raw) } : defaultState } catch (e) { return defaultState } }
    function save() { localStorage.setItem(LS_KEY, JSON.stringify(state)); }

    function addPoints(delta, reason, meta) { state.points += delta; state.ledger.unshift({ ts: now(), delta, reason, meta }); }
    function consecExtraDelta(prev) { const newC = prev + 1; const prevSq = (prev - 1) >= 0 ? (prev - 1) * (prev - 1) : 0; return 5 * (((newC - 1) * (newC - 1)) - prevSq); }
    function milestoneAward(cnt) { const m = { 3: 25, 6: 75, 8: 100 }; return m[cnt] || 0; }

    document.addEventListener('DOMContentLoaded', () => {
      // é‡ç½®å½“å‰è¿ç»­
      state.currentConsec = 0;
      save(); // ä¿å­˜çŠ¶æ€
      updateConsecBadge(); // æ›´æ–°æ˜¾ç¤º
    });

    function updateConsecBadge() {
      $('#consecBadge').textContent = 'å½“å‰è¿ç»­ï¼š' + state.currentConsec;
    }

    // =============== ä¸»é¢˜ä¸å£°éŸ³ ===============
    function applyTheme() {
      const root = document.body;
      const t = state.settings.theme;
      const map = {
        ocean: ['from-sky-50', 'via-cyan-50', 'to-indigo-50'],
        aurora: ['from-emerald-50', 'via-teal-50', 'to-lime-50'],
        candy: ['from-pink-50', 'via-rose-50', 'to-amber-50'],
        mono: ['from-slate-50', 'via-gray-50', 'to-zinc-50'],
        sunset: ['from-rose-50', 'via-sky-50', 'to-emerald-50'],
      };
      root.className = 'min-h-screen bg-gradient-to-br text-slate-800 ' + map[t].join(' ');
    }
    function useBeep() {
      const ctxRef = { current: null };
      const ensure = () => { if (!ctxRef.current) ctxRef.current = new (window.AudioContext || window.webkitAudioContext)(); };
      const play = (seq) => { if (!state.settings.sound) return; try { ensure(); const ctx = ctxRef.current; let t = ctx.currentTime; seq.forEach(([f, d]) => { const o = ctx.createOscillator(); const g = ctx.createGain(); o.type = 'sine'; o.frequency.value = f; g.gain.value = state.settings.volume; o.connect(g).connect(ctx.destination); o.start(t); o.stop(t + d / 1000); t += d / 1000 * 1.05; }); } catch (e) { } };
      return {
        start: () => play([[660, 120], [880, 120]]), pause: () => play([[440, 160]]), workDone: () => play([[880, 150], [988, 150], [1046, 220]]), breakDone: () => play([[523, 150], [659, 200]]), lottery: () => play([[392, 100], [523, 100], [659, 160]]), success: () => play([[784, 140], [988, 200]])
      };
    }

    // =============== å…¨å±€çŠ¶æ€ä¸å…ƒç´  ===============
    const state = load();
    // æ¸…ç†è¿ç§»ï¼šç§»é™¤å†å²ä¸­çš„â€œæŠ½å¥–äº§å‡ºâ€è®°å½•
    if (state && Array.isArray(state.ledger)) {
      state.ledger = state.ledger.filter(l => l.reason !== 'LOTTERY_GAIN');
      save();
    }
    const beep = useBeep();
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => document.querySelectorAll(sel);

    // é¡¶éƒ¨ä¸é¦–é¡µä¿¡æ¯
    $('#pointBadge').textContent = state.points;
    $('#quickPoints').textContent = state.points;
    $('#themeSelect').value = state.settings.theme;
    $('#soundToggle').checked = state.settings.sound;
    $('#year').textContent = new Date().getFullYear();

    function refreshTodayInfo() {
      const day = todayKey(new Date());
      const count = state.pomodoros.filter(p => todayKey(new Date(p.finishedAt)) === day).length;
      $('#todayCount').textContent = 'ä»Šæ—¥å·²å®Œæˆï¼š' + count;
      $('#consecBadge').textContent = 'å½“å‰è¿ç»­ï¼š' + state.currentConsec;
    }
    refreshTodayInfo();

    // ä¸»é¢˜ & å£°éŸ³
    $('#themeSelect').addEventListener('change', e => { state.settings.theme = e.target.value; applyTheme(); save(); });
    $('#soundToggle').addEventListener('change', e => { state.settings.sound = e.target.checked; save(); });
    applyTheme();

    // =============== è§†å›¾åˆ‡æ¢ ===============
    const views = ['home', 'sign', 'lottery', 'notice', 'stats', 'dev', 'ledger', "help"];
    function nav(to) { views.forEach(v => $('#view-' + v).classList.toggle('hidden', v !== to)); }
    document.querySelectorAll('[data-home]').forEach(b => b.addEventListener('click', () => nav('home')));
    document.querySelectorAll('[data-link]').forEach(a => a.addEventListener('click', (e) => { e.preventDefault(); const to = a.getAttribute('data-link'); nav(to); if (to === 'stats') { drawAllCharts(); } if (to === 'sign') { renderCalendar(); renderStreakStats(); } if (to === 'ledger') { buildLedgerFilterOptions(); renderLedgerPage(); } }));

    // =============== å¼€å‘è€…å¯†ç å¼¹çª— ===============
    function showDevPwdDialog(callback) {
      const dialog = document.getElementById('devPwdDialog');
      const input = document.getElementById('devPwdInput');
      dialog.classList.remove('hidden');
      input.value = '';
      input.focus();

      function close() {
        dialog.classList.add('hidden');
        document.getElementById('devPwdOk').onclick = null;
        document.getElementById('devPwdCancel').onclick = null;
      }

      document.getElementById('devPwdOk').onclick = function () {
        close();
        callback(input.value);
      };
      document.getElementById('devPwdCancel').onclick = function () {
        close();
        callback(null);
      };
    }

    // æ ‡é¢˜ç‚¹å‡» 5 æ¬¡è§£é”å¼€å‘è€…
    let clickCount = 0; let clickTimer = null;
    $('#appTitle').addEventListener('click', () => {
      clickCount++;
      clearTimeout(clickTimer);
      clickTimer = setTimeout(() => { clickCount = 0; }, 1200);
      if (clickCount >= 5) {
        showDevPwdDialog(function (pwd) {
          if (pwd === '8424') {
            state.devUnlocked = true;
            save();
            showAlert('å¼€å‘è€…æ¨¡å¼å·²è§£é”');
            nav('dev');
            updateDevStatus(); // æ›´æ–°å¼€å‘è€…æ¨¡å¼çŠ¶æ€
          } else if (pwd !== null) {
            showAlert('å¯†ç é”™è¯¯');
          }
          clickCount = 0;
        });
      }
    });
    $('#devBtn').addEventListener('click', () => nav('dev'));

    // =============== ç§¯åˆ†è®°å½•é¢æ¿ ===============
    function fmtTs(ts) {
      try { return new Date(ts).toLocaleString(); } catch (e) { return String(ts); }
    }
    function renderLedger() {
      const wrap = $('#ledgerList');
      if (!wrap) return;
      const list = state.ledger || [];
      wrap.innerHTML = list.length ? '' : '<div class="text-slate-500">æš‚æ— è®°å½•</div>';
      list.forEach((l, idx) => {
        const row = document.createElement('div');
        row.className = 'py-2 flex items-center justify-between';
        const left = document.createElement('div');
        const reason = SCORE_SRC[l.reason] || l.reason;
        left.innerHTML = `<div class="font-medium">${reason}</div><div class="text-xs text-slate-500">${fmtTs(l.ts)}</div>`;
        const right = document.createElement('div');
        right.className = 'font-bold ' + (l.delta >= 0 ? 'text-emerald-600' : 'text-rose-600');
        right.textContent = (l.delta >= 0 ? '+' : '') + l.delta;
        row.appendChild(left);
        row.appendChild(right);
        wrap.appendChild(row);
      });
    }
    const ledgerPanel = $('#ledgerPanel');
    const btnLedger = $('#btnLedger');
    const btnLedgerClose = $('#btnLedgerClose');
    if (btnLedger) {
      btnLedger.addEventListener('click', () => { if (ledgerPanel) { ledgerPanel.classList.toggle('hidden'); renderLedger(); } });
    }
    if (btnLedgerClose) {
      btnLedgerClose.addEventListener('click', () => { if (ledgerPanel) { ledgerPanel.classList.add('hidden'); } });
    }

    let quick = { work: 25, rest: 5, running: false, phase: 'work', remaining: 25 * 60, timer: null, loopsTarget: 4, loopsDone: 0 };

    function refreshTodayInfo() {
      const day = todayKey(new Date());
      const lastRefreshDate = localStorage.getItem('lastRefreshDate');

      // å¦‚æœæ—¥æœŸä¸ä¸€è‡´ï¼Œé‡ç½®ä»Šæ—¥å®Œæˆè®¡æ•°
      if (lastRefreshDate !== day) {
        localStorage.setItem('lastRefreshDate', day);
        state.pomodoros = state.pomodoros.filter(p => todayKey(new Date(p.finishedAt)) === day); // ä¿ç•™å½“å¤©è®°å½•
        save();
      }

      const count = state.pomodoros.filter(p => todayKey(new Date(p.finishedAt)) === day).length;
      $('#todayCount').textContent = 'ä»Šæ—¥å·²å®Œæˆï¼š' + count;
      $('#consecBadge').textContent = 'å½“å‰è¿ç»­ï¼š' + state.currentConsec;
    }

    function updateQuickUI() {
      if (!quick.running && quick.remaining === quick.work * 60) {
        // å¦‚æœè®¡æ—¶å™¨æœªè¿è¡Œä¸”å°šæœªå¼€å§‹
        $('#quickPhase').textContent = 'æœªå¼€å§‹ â³';
      } else if (!quick.running) {
        // å¦‚æœè®¡æ—¶å™¨æš‚åœ
        $('#quickPhase').textContent = quick.phase === 'work' ? 'ä¸“æ³¨ä¸­ ğŸ”¥ (å·²æš‚åœ)' : 'ä¼‘æ¯ä¸­ ğŸª´ (å·²æš‚åœ)';
      } else {
        // å¦‚æœè®¡æ—¶å™¨æ­£åœ¨è¿è¡Œ
        $('#quickPhase').textContent = quick.phase === 'work' ? 'ä¸“æ³¨ä¸­ ğŸ”¥' : 'ä¼‘æ¯ä¸­ ğŸª´';
      }

      const m = String(Math.floor(quick.remaining / 60)).padStart(2, '0');
      const s = String(Math.floor(quick.remaining % 60)).padStart(2, '0');
      $('#quickClock').textContent = `${m}:${s}`;
      const total = (quick.phase === 'work' ? quick.work : quick.rest) * 60;
      const deg = (1 - quick.remaining / Math.max(total, 1)) * 360;

      // æ ¹æ®å·¥ä½œæˆ–ä¼‘æ¯é˜¶æ®µè®¾ç½®é¢œè‰²
      const color = quick.phase === 'work' ? '#fb7185' : '#34d399'; // çº¢è‰²ï¼ˆå·¥ä½œï¼‰å’Œç»¿è‰²ï¼ˆä¼‘æ¯ï¼‰
      $('#quickRing').style.background = `conic-gradient(${color} ${deg}deg, rgba(255,255,255,0.6) 0deg)`;

      // åŠ¨æ€è®¡ç®—ä¸‹æ¬¡å®Œæˆç•ªèŒ„é’Ÿçš„ç§¯åˆ†ï¼ˆä¸åŒ…å«éšæœºå¥–åŠ±ï¼‰
      const basePoints = 50; // åŸºç¡€å¥–åŠ±
      const consecutiveBonus = consecExtraDelta(state.currentConsec || 0); // è¿ç»­å¥–åŠ±
      const nextPoints = basePoints + consecutiveBonus;

      $('#quickPoints').textContent = nextPoints; // æ›´æ–°ä¸‹æ¬¡è·å¾—çš„ç§¯åˆ†æ˜¾ç¤º
      $('#pointBadge').textContent = state.points;

      // å¾ªç¯çŠ¶æ€
      try {
        const st = document.getElementById('quickLoopsStatus');
        if (st) {
          st.textContent = `å¾ªç¯ï¼š${quick.loopsDone || 0}/${quick.loopsTarget || 0}`;
        }
      } catch (e) { }
    }


    function quickTick() {
      if (!quick.running) return;
      if (quick.remaining <= 0) {
        if (quick.phase === 'work') {
          // å®Œæˆå¥–åŠ±
          state.pomodoros.unshift({ finishedAt: now() });
          addPoints(50, 'POMO_BASE');
          const delta = consecExtraDelta(state.currentConsec || 0);
          if (delta > 0) addPoints(delta, 'POMO_CONSEC', { consec: (state.currentConsec || 0) + 1 });
          state.currentConsec = (state.currentConsec || 0) + 1;
          const r = Math.random(); if (r < 0.05) addPoints(100, 'POMO_RANDOM_100'); else if (r < 0.15) addPoints(10, 'POMO_RANDOM_10');
          const day = todayKey(new Date()); if (state.dayMilestones.date !== day) { state.dayMilestones = { date: day, hits: [] }; }
          const todayCount = state.pomodoros.filter(p => todayKey(new Date(p.finishedAt)) === day).length;
          const award = milestoneAward(todayCount);
          if (award > 0 && !state.dayMilestones.hits.includes(todayCount)) { addPoints(award, 'DAILY_MILESTONE', { milestone: todayCount }); state.dayMilestones.hits.push(todayCount); }
          save(); refreshTodayInfo();
          // å®Œæˆä¸€ä¸ªç•ªèŒ„ï¼ˆå·¥ä½œæ®µï¼‰
          quick.loopsDone = (quick.loopsDone || 0) + 1;
          beep.workDone();
          // è‹¥è¾¾åˆ°ç›®æ ‡å¾ªç¯æ¬¡æ•°ï¼Œåˆ™åœè¡¨å¹¶å¤ä½åˆ°å·¥ä½œæ®µèµ·ç‚¹
          if (quick.loopsTarget > 0 && quick.loopsDone >= quick.loopsTarget) {
            quick.running = false; quick.phase = 'work'; quick.remaining = quick.work * 60;
            showAlert(`æœ¬è½®å·²å®Œæˆ ${quick.loopsDone} ä¸ªç•ªèŒ„ï¼Œå·²ç»“æŸã€‚`);
          } else {
            quick.phase = 'break'; quick.remaining = quick.rest * 60; quick.running = true;
          }
        } else {
          beep.breakDone();
          quick.phase = 'work'; quick.remaining = quick.work * 60; quick.running = true;
        }
      } else {
        quick.remaining -= 1;
      }
      updateQuickUI();
    }
    setInterval(quickTick, 1000);
    $('#quickStart').addEventListener('click', () => {
      quick.work = clamp(parseFloat($('#quickWork').value || '25'), 0.1, 600); // æ”¯æŒå°æ•°
      quick.rest = clamp(parseFloat($('#quickBreak').value || '5'), 0.1, 600); // æ”¯æŒå°æ•°
      quick.loopsTarget = clamp(parseInt($('#quickLoops').value || '4'), 1, 999);
      quick.loopsDone = 0;
      quick.phase = 'work';
      quick.remaining = quick.work * 60; // å°†åˆ†é’Ÿè½¬æ¢ä¸ºç§’
      quick.running = true;
      $('#quickStart').classList.add('hidden');
      $('#quickPause').classList.remove('hidden');
      beep.start();
      updateQuickUI();
    });
    $('#quickPause').addEventListener('click', () => {
      quick.running = false; // è®¾ç½®ä¸ºæš‚åœçŠ¶æ€
      clearInterval(quick.timer); // åœæ­¢è®¡æ—¶å™¨
      $('#quickPause').classList.add('hidden');
      $('#quickStart').classList.remove('hidden');
      updateQuickUI(); // æ›´æ–°ç•Œé¢
    });
    $('#quickReset').addEventListener('click', () => { quick.running = false; quick.phase = 'work'; quick.remaining = quick.work * 60; quick.loopsDone = 0; save(); updateQuickUI(); });
    updateQuickUI();



    // =============== Ledger å·¥å…·ï¼šè¿‡æ»¤ / æ’åº / å¯¼å‡º ===============
    function beginningOfMonth(d) {
      const x = new Date(d.getFullYear(), d.getMonth(), 1); x.setHours(0, 0, 0, 0); return x;
    }
    function endOfDay(d) {
      const x = new Date(d); x.setHours(23, 59, 59, 999); return x;
    }
    function getFilteredAndSortedLedger() {
      const list = state.ledger || [];
      const reasonSel = document.getElementById('ledgerFilter');
      const rangeSel = document.getElementById('timeRange');
      const fromEl = document.getElementById('dateFrom');
      const toEl = document.getElementById('dateTo');
      const sortField = (document.getElementById('sortField') || { value: 'time' }).value;
      const sortOrder = (document.getElementById('sortOrder') || { value: 'desc' }).value;

      const activeReason = reasonSel ? reasonSel.value : 'ALL';
      const now = new Date();
      let fromTs = null, toTs = null;
      if (rangeSel) {
        const mode = rangeSel.value;
        if (mode === 'LAST7') {
          const from = new Date(now.getTime() - 6 * 24 * 3600 * 1000); from.setHours(0, 0, 0, 0);
          const to = endOfDay(now);
          fromTs = +from; toTs = +to;
        } else if (mode === 'MONTH') {
          const from = beginningOfMonth(now);
          const to = endOfDay(now);
          fromTs = +from; toTs = +to;
        } else if (mode === 'CUSTOM') {
          const f = fromEl && fromEl.value ? new Date(fromEl.value + 'T00:00:00') : null;
          const t = toEl && toEl.value ? new Date(toEl.value + 'T23:59:59') : null;
          if (f) fromTs = +f; if (t) toTs = +t;
        }
      }

      // 1) åŸå› ç­›é€‰
      let arr = activeReason === 'ALL' ? list.slice() : list.filter(l => l.reason === activeReason);
      // 2) æ—¶é—´ç­›é€‰
      arr = arr.filter(l => {
        if (fromTs != null && +l.ts < fromTs) return false;
        if (toTs != null && +l.ts > toTs) return false;
        return true;
      });
      // 3) æ’åº
      arr.sort((a, b) => {
        let av = sortField === 'delta' ? (a.delta || 0) : (a.ts || 0);
        let bv = sortField === 'delta' ? (b.delta || 0) : (b.ts || 0);
        if (sortOrder === 'asc') return av - bv;
        return bv - av;
      });
      return arr;
    }

    function exportLedgerCSV() {
      const rows = getFilteredAndSortedLedger();
      const header = ['æ—¶é—´', 'é¡¹ç›®', 'å˜åŠ¨'];
      const lines = [header.join(',')];
      rows.forEach(l => {
        const t = fmtTs(l.ts).replace(/,/g, ' ');
        const reason = (SCORE_SRC[l.reason] || l.reason).replace(/,/g, ' ');
        const delta = (l.delta >= 0 ? '+' : '') + l.delta;
        lines.push([t, reason, delta].join(','));
      });
      const csv = '\ufeff' + lines.join('\n'); // BOM ä»¥ä¾¿ Excel æ­£ç¡®è¯†åˆ« UTF-8
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      const now = new Date();
      const pad = n => String(n).padStart(2, '0');
      a.href = url;
      a.download = `ç§¯åˆ†è®°å½•_${now.getFullYear()}${pad(now.getMonth() + 1)}${pad(now.getDate())}.csv`;
      document.body.appendChild(a);
      a.click();
      setTimeout(() => { URL.revokeObjectURL(url); a.remove(); }, 0);
    }

    // =============== ç§¯åˆ†è®°å½•é¡µé¢ ===============
    function fmtTs(ts) {
      try { return new Date(ts).toLocaleString(); } catch (e) { return String(ts); }
    }

    function buildLedgerFilterOptions() {
      const sel = $('#ledgerFilter'); if (!sel) return;
      // collect reason codes present in ledger
      const list = state.ledger || [];
      const codes = Array.from(new Set(list.map(l => l.reason))).filter(Boolean);
      // clear (keep 'å…¨éƒ¨' as first option)
      sel.innerHTML = '';
      const optAll = document.createElement('option'); optAll.value = 'ALL'; optAll.textContent = 'å…¨éƒ¨'; sel.appendChild(optAll);
      codes.forEach(code => {
        const opt = document.createElement('option');
        const label = SCORE_SRC[code] || code;
        opt.value = code;
        opt.textContent = label;
        sel.appendChild(opt);
      });
    }

    // æ¸²æŸ“ç§¯åˆ†è®°å½•é¡µé¢
    function renderLedgerPage() {
      const wrap = $('#ledgerList');
      if (!wrap) return;
      const rows = getFilteredAndSortedLedger();
      wrap.innerHTML = rows.length ? '' : '<div class="text-slate-500">æš‚æ— è®°å½•</div>';
      rows.forEach((l) => {
        const row = document.createElement('div');
        row.className = 'py-2 flex text-center';
        const time = document.createElement('div'); time.className = 'flex-1'; time.textContent = fmtTs(l.ts);
        const reasonDiv = document.createElement('div'); reasonDiv.className = 'flex-1'; reasonDiv.textContent = (SCORE_SRC[l.reason] || l.reason);
        const deltaDiv = document.createElement('div'); deltaDiv.className = 'flex-1 font-bold ' + (l.delta >= 0 ? 'text-emerald-600' : 'text-rose-600'); deltaDiv.textContent = (l.delta >= 0 ? '+' : '') + l.delta;
        row.appendChild(time); row.appendChild(reasonDiv); row.appendChild(deltaDiv);
        wrap.appendChild(row);
      });
    }


    // äº¤äº’ç›‘å¬ï¼šç­›é€‰ä¸æ’åº
    document.addEventListener('change', (e) => {
      const id = e.target && e.target.id;
      if (id === 'ledgerFilter' || id === 'timeRange' || id === 'sortField' || id === 'sortOrder' || id === 'dateFrom' || id === 'dateTo') {
        // è‹¥é€‰æ‹©â€œè‡ªå®šä¹‰â€ï¼Œæ˜¾ç¤ºæ—¥æœŸè¾“å…¥
        if (id === 'timeRange') {
          const cd = document.getElementById('customDates');
          if (cd) { cd.classList.toggle('hidden', e.target.value !== 'CUSTOM'); }
        }
        renderLedgerPage();
      }
    });
    // å¯¼å‡º CSV
    document.addEventListener('click', (e) => {
      if (e.target && e.target.id === 'exportCSV') {
        exportLedgerCSV();
      }
    });

    // =============== ç­¾åˆ°æ—¥å† ===============
    let calState = (() => { const d = new Date(); return { year: d.getFullYear(), month: d.getMonth() }; })();
    function firstDayOfMonth(y, m) { return new Date(y, m, 1); }
    function daysInMonth(y, m) { return new Date(y, m + 1, 0).getDate(); }
    function renderCalendar() {
      const titleEl = document.getElementById('calTitle');
      const gridEl = document.getElementById('calGrid');
      if (!titleEl || !gridEl) return;
      const y = calState.year, m = calState.month;
      titleEl.textContent = `${y} å¹´ ${m + 1} æœˆ`;
      const first = firstDayOfMonth(y, m);
      const startWeekday = first.getDay();
      const dim = daysInMonth(y, m);
      const signed = new Set((state.sign && state.sign.history) ? state.sign.history : []);
      const cells = [];
      const prevDim = daysInMonth(y, (m - 1 + 12) % 12);
      for (let i = 0; i < startWeekday; i++) {
        const dayNum = prevDim - startWeekday + 1 + i;
        cells.push({ type: 'prev', day: dayNum, real: new Date(y, m - 1, dayNum) });
      }
      for (let d = 1; d <= dim; d++) { cells.push({ type: 'cur', day: d, real: new Date(y, m, d) }); }
      while (cells.length % 7 !== 0 || cells.length < 42) {
        const d = cells.length - (startWeekday + dim) + 1;
        cells.push({ type: 'next', day: d, real: new Date(y, m + 1, d) });
      }
      gridEl.innerHTML = '';
      const todayStr = todayKey(new Date());
      cells.forEach(c => {
        const cell = document.createElement('div');
        cell.className = 'cal-cell' + (c.type !== 'cur' ? ' muted' : '');
        const yyyy = c.real.getFullYear();
        const mm = String(c.real.getMonth() + 1).padStart(2, '0');
        const dd = String(c.real.getDate()).padStart(2, '0');
        const key = `${yyyy}-${mm}-${dd}`;
        const day = document.createElement('div'); day.className = 'day'; day.textContent = c.day;
        const mark = document.createElement('div'); mark.className = 'mark'; mark.textContent = signed.has(key) ? 'âœ…' : (key === todayStr ? 'â€¢' : '');
        cell.appendChild(day); cell.appendChild(mark); gridEl.appendChild(cell);
      });
    }
    document.addEventListener('click', e => {
      if (e.target && e.target.id === 'calPrev') { if (calState.month === 0) { calState.month = 11; calState.year--; } else { calState.month--; } renderCalendar(); renderStreakStats(); }
      if (e.target && e.target.id === 'calNext') { if (calState.month === 11) { calState.month = 0; calState.year++; } else { calState.month++; } renderCalendar(); renderStreakStats(); }
    });



    // =============== ç­¾åˆ°è¿ç»­ç»Ÿè®¡ ===============
    function ymd(d) {
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth() + 1).padStart(2, '0');
      const dd = String(d.getDate()).padStart(2, '0');
      return `${yyyy}-${mm}-${dd}`;
    }
    function parseHistory(hist) {
      if (!hist || !hist.length) return [];
      const uniq = Array.from(new Set(hist));
      const dates = uniq.map(s => new Date(s + 'T00:00:00')).filter(d => !isNaN(d));
      dates.sort((a, b) => a - b);
      return dates;
    }
    function computeStreakStats(hist) {
      const dates = parseHistory(hist);
      if (dates.length === 0) {
        return { maxLen: 0, maxStart: null, maxEnd: null, breaks: [] };
      }
      let maxLen = 1, curLen = 1;
      let maxStart = dates[0], maxEnd = dates[0];
      let curStart = dates[0];
      const breaks = [];
      for (let i = 1; i < dates.length; i++) {
        const prev = dates[i - 1];
        const curr = dates[i];
        const diffDays = Math.round((curr - prev) / 86400000);
        if (diffDays === 1) {
          curLen += 1;
        } else {
          // è®°å½•æ–­ç‚¹ï¼šprev -> curr ä¹‹é—´å‡ºç°äº† gap
          breaks.push({ from: ymd(prev), to: ymd(curr), gapDays: diffDays - 1 });
          // ç»“ç®—å½“å‰è¿ç»­
          if (curLen > maxLen) { maxLen = curLen; maxStart = curStart; maxEnd = prev; }
          curLen = 1; curStart = curr;
        }
        // æœ€åä¸€æ®µæ”¶å°¾
        if (i === dates.length - 1) {
          if (curLen > maxLen) { maxLen = curLen; maxStart = curStart; maxEnd = curr; }
        }
      }
      // å¦‚æœå†å²åªæœ‰ä¸€å¤©
      if (dates.length === 1) { maxStart = dates[0]; maxEnd = dates[0]; }
      return { maxLen, maxStart, maxEnd, breaks };
    }
    function renderStreakStats() {
      const elMax = document.getElementById('streakMax');
      const elBreaks = document.getElementById('streakBreaks');
      if (!elMax || !elBreaks) return;
      const hist = (state.sign && state.sign.history) ? state.sign.history : [];
      const st = computeStreakStats(hist);
      if (st.maxLen > 0) {
        const range = (st.maxStart && st.maxEnd) ? `ï¼ˆ${ymd(st.maxStart)} è‡³ ${ymd(st.maxEnd)}ï¼‰` : '';
        elMax.textContent = `æœ€é•¿è¿ç»­ï¼š${st.maxLen} å¤© ${range}`;
      } else {
        elMax.textContent = 'æœ€é•¿è¿ç»­ï¼šâ€”';
      }
      if (st.breaks.length === 0) {
        elBreaks.textContent = 'æ–­ç‚¹ï¼šæ— ';
      } else {
        // ä»…æ˜¾ç¤ºæœ€è¿‘ 5 ä¸ªæ–­ç‚¹ï¼Œæ ¼å¼ï¼šYYYY-MM-DD â†’ YYYY-MM-DDï¼ˆé—´éš” n å¤©ï¼‰
        const recent = st.breaks.slice(-5);
        elBreaks.innerHTML = 'æ–­ç‚¹ï¼š' + recent.map(b => `${b.from} â†’ ${b.to}ï¼ˆé—´éš” ${b.gapDays} å¤©ï¼‰`).join('ï¼›');
      }
    }


    // =============== ç­¾åˆ° ===============
    function refreshSign() { const s = state.sign; $('#signLast').textContent = 'ä¸Šæ¬¡ç­¾åˆ°ï¼š' + (s.lastDate || 'â€”'); $('#signStreak').textContent = 'è¿ç»­ï¼š' + s.streak + ' å¤©ï¼ˆä¸Šé™ 30ï¼‰'; $('#signTotal').textContent = 'ç´¯è®¡ç­¾åˆ°ï¼š' + (s.totalDays || 0) + ' å¤©'; renderCalendar(); renderStreakStats(); }
    refreshSign();
    $('#btnSign').addEventListener('click', () => {
      const day = todayKey(new Date()); if (state.sign.lastDate === day) { showAlert('ä»Šæ—¥å·²ç­¾åˆ°'); $('#btnSign').textContent = 'âœ’ ä»Šæ—¥å·²ç­¾'; return; }
      const y = todayKey(new Date(Date.now() - 24 * 3600 * 1000)); let next = state.sign.lastDate === y ? state.sign.streak + 1 : 1; next = Math.min(next, 30);
      if (!state.sign.history) state.sign.history = []; if (!state.sign.history.includes(day)) state.sign.history.push(day); state.sign = { lastDate: day, streak: next, totalDays: (state.sign.totalDays || 0) + 1, history: state.sign.history };
      const reward = next * 10; addPoints(reward, 'SIGNIN', { streak: next }); beep.success(); save(); refreshSign(); $('#btnSign').textContent = 'âœ’ ä»Šæ—¥å·²ç­¾'; $('#pointBadge').textContent = state.points; $('#quickPoints').textContent = state.points; showAlert(`ç­¾åˆ°æˆåŠŸï¼Œå¥–åŠ± ${reward} åˆ†ï¼ˆè¿ç»­ ${next} å¤©ï¼‰`); renderStreakStats();
    });

    // =============== ä¸€ç•ªèµè®°å½• ===============
    function fmtTs(ts) { try { return new Date(ts).toLocaleString(); } catch (e) { return String(ts); } }
    function renderLotteryLog() {
      const wrap = $('#lotteryLogList'); if (!wrap) return;
      const list = (state.lotteryLog && Array.isArray(state.lotteryLog)) ? state.lotteryLog : [];
      wrap.innerHTML = list.length ? '' : '<div class="text-slate-500 p-2 text-center">æš‚æ— è®°å½•</div>';
      list.forEach((r) => {
        const row = document.createElement('div');
        row.className = 'py-2 flex text-center';
        const time = document.createElement('div'); time.className = 'flex-1'; time.textContent = fmtTs(r.ts);
        const tier = document.createElement('div'); tier.className = 'flex-1'; tier.textContent = (r.tier + 'èµ');
        const prize = document.createElement('div'); prize.className = 'flex-1'; prize.textContent = r.prize;
        row.appendChild(time); row.appendChild(tier); row.appendChild(prize);
        wrap.appendChild(row);
      });
    }
    (function attachLotteryLogHandlers() {
      const btn = document.getElementById('btnLotteryLog');
      const panel = document.getElementById('lotteryLogPanel');
      const close = document.getElementById('btnLotteryLogClose');
      if (btn && panel) {
        btn.addEventListener('click', () => { panel.classList.toggle('hidden'); renderLotteryLog(); });
      }
      if (close && panel) {
        close.addEventListener('click', () => panel.classList.add('hidden'));
      }
    })();

    const tierProb = { A: 0.03, B: 0.085, C: 0.885 };
    function drawTier() { const r = Math.random(); if (r < tierProb.A) return 'A'; else if (r < tierProb.A + tierProb.B) return 'B'; return 'C'; }
    $('#btnDraw').addEventListener('click', () => {
      if (state.points < 300) { showAlert('ç§¯åˆ†ä¸è¶³ï¼ˆéœ€è¦ 300ï¼‰'); return; }
      addPoints(-300, 'LOTTERY_COST'); save(); $('#pointBadge').textContent = state.points; $('#quickPoints').textContent = state.points;
      beep.lottery();
      const wrap = $('#flipWrap'); wrap.classList.remove('rotate-y-180'); $('#lotteryResult').classList.add('hidden');
      setTimeout(() => wrap.classList.add('rotate-y-180'), 100);
      setTimeout(() => {
        const tier = drawTier(); const pool = state.lottery[tier]; const prize = pool.length ? randomChoice(pool) : `${tier}ç±»ç©ºå¥–`;
        $('#lotteryPrize').textContent = prize; $('#lotteryTier').textContent = tier + 'èµ'; $('#lotteryResult').classList.remove('hidden');
        // è®°å½•æŠ½å¥–æ—¥å¿—ï¼ˆä¸æ¶‰åŠç§¯åˆ†ï¼‰
        try {
          if (!Array.isArray(state.lotteryLog)) state.lotteryLog = [];
          state.lotteryLog.unshift({ ts: Date.now(), tier, prize });
        } catch (e) { }
        save();
      }, 900);
    });

    // å¥–æ± è®¾ç½®
    const dlg = document.getElementById('poolDialog');
    $('#btnPool').addEventListener('click', () => { $('#poolA').value = state.lottery.A.join('\n'); $('#poolB').value = state.lottery.B.join('\n'); $('#poolC').value = state.lottery.C.join('\n'); dlg.showModal(); });
    $('#poolSave').addEventListener('click', (e) => { e.preventDefault(); state.lottery = { A: $('#poolA').value.split(/\n+/).filter(Boolean), B: $('#poolB').value.split(/\n+/).filter(Boolean), C: $('#poolC').value.split(/\n+/).filter(Boolean) }; save(); dlg.close(); });

    // =============== ç»Ÿè®¡ï¼ˆChart.jsï¼‰ ===============
    let charts = {};
    function drawAllCharts() {
      // å½“æ—¥æŒ‰å°æ—¶
      const today = todayKey(new Date()); const byHour = Array.from({ length: 24 }, (_, h) => 0);
      state.pomodoros.forEach(p => { const d = new Date(p.finishedAt); if (todayKey(d) === today) byHour[d.getHours()]++; });
      charts.hour && charts.hour.destroy(); charts.hour = new Chart(document.getElementById('chartHour'), { type: 'bar', data: { labels: byHour.map((_, i) => i + ':00'), datasets: [{ label: 'å®Œæˆæ•°', data: byHour }] }, options: { responsive: true, maintainAspectRatio: false } });

      // æœ€è¿‘7å¤©
      const end = startOfDay(now()); const start = end - 6 * 24 * 3600 * 1000; const by7 = Array.from({ length: 7 }, () => 0);
      state.pomodoros.forEach(p => { const d = startOfDay(p.finishedAt); if (d >= start && d <= end) { const idx = Math.floor((d - start) / (24 * 3600 * 1000)); by7[idx]++; } });
      charts.d7 && charts.d7.destroy(); charts.d7 = new Chart(document.getElementById('chart7'), { type: 'bar', data: { labels: by7.map((_, i) => { const dd = new Date(start + i * 24 * 3600 * 1000); return dd.toISOString().slice(5, 10); }), datasets: [{ label: 'å®Œæˆæ•°', data: by7 }] }, options: { responsive: true, maintainAspectRatio: false } });

      // å½“æœˆ
      const sMonth = startOfMonth(now()); const base = new Date(sMonth); const daysInMonth = new Date(base.getFullYear(), base.getMonth() + 1, 0).getDate(); const byM = Array.from({ length: daysInMonth }, () => 0);
      state.pomodoros.forEach(p => { const d = new Date(p.finishedAt); if (d.getTime() >= sMonth && d.getMonth() === base.getMonth()) { byM[d.getDate() - 1]++; } });
      charts.month && charts.month.destroy(); charts.month = new Chart(document.getElementById('chartMonth'), { type: 'bar', data: { labels: byM.map((_, i) => String(i + 1)), datasets: [{ label: 'å®Œæˆæ•°', data: byM }] }, options: { responsive: true, maintainAspectRatio: false } });

      // ç§¯åˆ†æ”¶æ”¯ä¸æ¥æº
      const byReason = {}; state.ledger.forEach(l => { const key = SCORE_SRC[l.reason] || l.reason; byReason[key] = (byReason[key] || 0) + l.delta; });
      const labels = Object.keys(byReason); const data = labels.map(k => byReason[k]);
      charts.ledger && charts.ledger.destroy(); charts.ledger = new Chart(document.getElementById('chartLedger'), { type: 'bar', data: { labels, datasets: [{ label: 'ç§¯åˆ†å˜åŒ–', data }] }, options: { responsive: true, maintainAspectRatio: false, indexAxis: 'y' } });
    }

    // =============== å¼€å‘è€…é¢æ¿ ===============
    $('#devLockBtn').addEventListener('click', () => {
      showConfirm('ç¡®å®šå…³é—­å¼€å‘è€…æ¨¡å¼ï¼Ÿ', (confirmed) => {
        if (confirmed) {
          state.devUnlocked = false;
          save();
          updateDevStatus(); // æ›´æ–°å¼€å‘è€…æ¨¡å¼çŠ¶æ€
          showAlert('å¼€å‘è€…æ¨¡å¼å·²å…³é—­');
        }
      });
    });

    $('#devApply').addEventListener('click', () => {
      if (!state.devUnlocked) {
        showAlert('æœªè§£é”å¼€å‘è€…æ¨¡å¼');
        return;
      }

      // ä½¿ç”¨è‡ªå®šä¹‰ç¡®è®¤å¼¹çª—
      showConfirm('ç¡®å®šåº”ç”¨ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚', function (confirmed) {
        if (!confirmed) return; // å¦‚æœç”¨æˆ·å–æ¶ˆï¼Œåˆ™ä¸æ‰§è¡Œåç»­é€»è¾‘

        const pts = parseInt($('#devPts').value || '0'); // ä¿®æ”¹ç§¯åˆ†
        const add = parseInt($('#devPomos').value || '0'); // å¢åŠ ç•ªèŒ„é’Ÿæ•°é‡

        if (pts) addPoints(pts, 'ADJUST');
        for (let i = 0; i < add; i++) {
          state.pomodoros.unshift({ finishedAt: now() });
        }

        // é‡æ–°è®¡ç®—å½“å‰è¿ç»­å®Œæˆçš„ç•ªèŒ„é’Ÿæ•°é‡
        const today = todayKey(new Date());
        const todayPomodoros = state.pomodoros.filter(p => todayKey(new Date(p.finishedAt)) === today);
        state.currentConsec = todayPomodoros.length;

        save(); // ä¿å­˜çŠ¶æ€
        refreshTodayInfo(); // åˆ·æ–°ä»Šæ—¥ä¿¡æ¯
        updateQuickUI(); // æ›´æ–° UI

        $('#pointBadge').textContent = state.points;
        $('#quickPoints').textContent = state.points;

        showAlert('å·²åº”ç”¨');
      });
    });

    $('#devClear').addEventListener('click', () => {
      showConfirm('ç¡®å®šæ¸…ç©ºæ‰€æœ‰æœ¬åœ°æ•°æ®ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚', function (ok) {
        if (ok) {
          localStorage.removeItem(LS_KEY);
          location.reload();
        }
      });
    });

    // =============== è‡ªæµ‹ï¼ˆæ§åˆ¶å°ï¼‰ ===============
    console.assert(consecExtraDelta(0) === 0, 'T1'); console.assert(consecExtraDelta(1) === 5, 'T2'); console.assert(consecExtraDelta(2) === 15, 'T3');
    console.assert(milestoneAward(3) === 25, 'M1'); console.assert(milestoneAward(6) === 75, 'M2'); console.assert(milestoneAward(8) === 100, 'M3'); console.assert(milestoneAward(4) === 0, 'M4');
    console.info('%cSelf tests passed', 'color:green');

    // =============== è‡ªå®šä¹‰å¼¹çª— ===============
    function showAlert(msg) {
      const alertBox = document.getElementById('customAlert');
      const alertMsg = document.getElementById('customAlertMsg');
      alertMsg.textContent = msg;
      alertBox.classList.remove('hidden');
      document.getElementById('customAlertBtn').onclick = () => {
        alertBox.classList.add('hidden');
      };
    }

    function showConfirm(msg, callback) {
      // å¦‚æœå·²å­˜åœ¨åˆ™å¤ç”¨
      let dialog = document.getElementById('customConfirm');
      if (!dialog) {
        dialog = document.createElement('div');
        dialog.id = 'customConfirm';
        dialog.className = 'fixed inset-0 bg-black/30 flex items-center justify-center z-50';
        dialog.innerHTML = `
      <div class="bg-white rounded-xl p-5 shadow text-center min-w-[220px]">
        <div class="mb-3 font-semibold" id="customConfirmMsg"></div>
        <div class="flex justify-center gap-3">
          <button id="customConfirmCancel" class="border rounded px-4 py-2 bg-slate-200">å–æ¶ˆ</button>
          <button id="customConfirmOk" class="border rounded px-4 py-2 bg-amber-50">ç¡®å®š</button>
        </div>
      </div>
    `;
        document.body.appendChild(dialog);
      }
      document.getElementById('customConfirmMsg').textContent = msg;
      dialog.classList.remove('hidden');
      document.getElementById('customConfirmOk').onclick = function () {
        dialog.classList.add('hidden');
        callback(true);
      };
      document.getElementById('customConfirmCancel').onclick = function () {
        dialog.classList.add('hidden');
        callback(false);
      };
    }

    function updateDevStatus() {
      const devStatusText = $('#devStatusText');
      const devLockBtn = $('#devLockBtn');

      if (state.devUnlocked) {
        devStatusText.textContent = 'å·²è§£é”å¼€å‘è€…æ¨¡å¼';
        devStatusText.classList.remove('text-red-600');
        devLockBtn.classList.remove('hidden'); // æ˜¾ç¤ºå…³é—­æŒ‰é’®
      } else {
        devStatusText.textContent = 'ğŸ”’ æœªè§£é”å¼€å‘è€…æ¨¡å¼ï¼Œä»¥ä¸‹åŠŸèƒ½ä¸å¯ä½¿ç”¨ã€‚';
        devStatusText.classList.add('text-red-600');
        devLockBtn.classList.add('hidden'); // éšè—å…³é—­æŒ‰é’®
      }
    }

    updateDevStatus();

  </script>
</body>

</html>